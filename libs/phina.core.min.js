/*
 * phina-minimizer 1.0.0 used 
 *
 * phina.js 0.2.0
 * phina.js is a game library in javascript
 * MIT Licensed
 * 
 * Copyright (C) 2015 phi, http://phinajs.com
 */


'use strict';

"use strict";!function(){Object.defineProperty(Object.prototype,"$method",{value:function(t,e){Object.defineProperty(this,t,{value:e,enumerable:!1,writable:!0})}}),Object.prototype.$method("setter",function(t,e){Object.defineProperty(this,t,{set:e,enumerable:!1,configurable:!0})}),Object.prototype.$method("getter",function(t,e){Object.defineProperty(this,t,{get:e,enumerable:!1,configurable:!0})}),Object.prototype.$method("accessor",function(t,e){Object.defineProperty(this,t,{set:e.set,get:e.get,enumerable:!1,configurable:!0})}),Object.prototype.$method("forIn",function(t,e){return e=e||this,Object.keys(this).forEach(function(i,n){var s=this[i];t.call(e,i,s,n)},this),this}),Object.prototype.$method("$get",function(t){return t.split(".").reduce(function(t,e){return t&&t[e]},this)}),Object.prototype.$method("$set",function(t,e){t.split(".").reduce(function(t,i,n,s){return n!==s.length-1?(t[i]||(t[i]={}),t[i]):void(t[i]=e)},this)}),Object.prototype.$method("$has",function(t){return this.hasOwnProperty(t)}),Object.prototype.$method("$extend",function(){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)this[e]=t[e]},this),this}),Object.prototype.$method("$safe",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)void 0===this[e]&&(this[e]=t[e])},this),this}),Object.prototype.$method("$strict",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)console.assert(!this[e],"tm error: {0} is Already".format(e)),this[e]=t[e]},this),this}),Object.prototype.$method("$pick",function(){var t={};return Array.prototype.forEach.call(arguments,function(e){e in this&&(t[e]=this[e])},this),t}),Object.prototype.$method("$omit",function(){var t={};for(var e in this)Array.prototype.indexOf.call(arguments,e)==-1&&(t[e]=this[e]);return t}),Object.prototype.$method("$toArray",function(){return Array.prototype.slice.call(this)}),Object.prototype.$method("$watch",function(t,e){for(var i=this,n=null;i&&!(n=Object.getOwnPropertyDescriptor(i,t));)i=Object.getPrototypeOf(i);if(n)if(void 0!==n.value){var s="__"+t,r=this[t];this[s]=r,this.accessor(t,{get:function(){return this[s]},set:function(t){var i=this[s];this[s]=t,e.call(this,t,i)}})}else this.accessor(t,{get:function(){return n.get.call(this)},set:function(t){var i=n.get.call(this);n.set.call(this,t),e.call(this,t,i)}});else{var a="__"+t;this.accessor(t,{get:function(){return this[a]},set:function(t){var i=this[a];this[a]=t,e.call(this,t,i)}})}}),Object.observe||Object.$method("observe",function(t,e){var i=Object.keys(t);i.forEach(function(i){var n="__"+i,s=t[i];t[n]=s,t.accessor(i,{get:function(){return this[n]},set:function(t){this[n]=t,e()}})})}),Object.unobserve||Object.$method("unobserve",function(t,e){console.assert(!1)})}(),function(){Number.prototype.$method("round",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.round(i),i/e}),Number.prototype.$method("ceil",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.ceil(i),i/e}),Number.prototype.$method("floor",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.floor(i),i/e}),Number.prototype.$method("toInt",function(){return 0|this}),Number.prototype.$method("toHex",function(){return this.toString(16)}),Number.prototype.$method("toBin",function(){return this.toString(2)}),Number.prototype.$method("toUnsigned",function(){return this>>>0}),Number.prototype.$method("padding",function(t,e){var i=this+"";for(t-=i.length,e=(e||"0")[0];t-- >0;)i=e+i;return i.indexOf("-")>=0&&(i="-"+i.replace("-","")),i}),Number.prototype.$method("times",function(t,e){e=e||this;for(var i=0;i<this;++i)t.call(e,i,this);return this}),Number.prototype.$method("upto",function(t,e,i){i=i||this;for(var n=+this;n<=t;++n)e.call(i,n,this);return this}),Number.prototype.$method("downto",function(t,e,i){i=i||this;for(var n=+this;n>=t;--n)e.call(i,n,this);return this}),Number.prototype.$method("step",function(t,e,i,n){n=n||this;for(var s=+this;s<=t;s+=e)i.call(n,s,this);return this}),Number.prototype.$method("map",function(t,e){e=e||this;for(var i=[],n=0;n<this;++n){var s=t.call(e,n);i.push(s)}return i}),Number.prototype.$method("abs",function(){return Math.abs(this)}),Number.prototype.$method("acos",function(){return Math.acos(this)}),Number.prototype.$method("asin",function(){return Math.asin(this)}),Number.prototype.$method("atan",function(){return Math.atan(this)}),Number.prototype.$method("cos",function(){return Math.cos(this)}),Number.prototype.$method("exp",function(){return Math.exp(this)}),Number.prototype.$method("log",function(){return Math.log(this)}),Number.prototype.$method("max",function(t){return Math.max(this,t)}),Number.prototype.$method("min",function(t){return Math.min(this,t)}),Number.prototype.$method("clamp",function(t,e){return Math.clamp(this,t,e)}),Number.prototype.$method("pow",function(t){return Math.pow(this,t)}),Number.prototype.$method("sin",function(){return Math.sin(this)}),Number.prototype.$method("sqrt",function(){return Math.sqrt(this)}),Number.prototype.$method("tan",function(){return Math.tan(this)}),Number.prototype.$method("toDegree",function(){return this*Math.RAD_TO_DEG}),Number.prototype.$method("toRadian",function(){return this*Math.DEG_TO_RAD})}(),function(){String.prototype.$method("format",function(t){var e=void 0;if("object"==typeof t)e=function(e,i){return void 0===t[i]?"":t[i]};else{var i=arguments;e=function(t,e){var n=i[parseInt(e)];return void 0!==n&&null!==n?n:""}}return this.replace(/\{(\w+)\}/g,e)}),String.prototype.$method("trim",function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.$method("capitalize",function(){return this.replace(/\w+/g,function(t){return t.capitalizeFirstLetter()})}),String.prototype.$method("capitalizeFirstLetter",function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()}),String.prototype.$method("toDash",function(){return this.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}),String.prototype.$method("toHash",function(){return this.toCRC32()}),String.prototype.$method("padding",function(t,e){var i=this.toString();for(t-=i.length,e=(e||" ")[0];t-- >0;)i=e+i;return i}),String.prototype.$method("paddingLeft",function(t,e){var i=this.toString();for(t-=i.length,e=(e||" ")[0];t-- >0;)i=e+i;return i}),String.prototype.$method("paddingRight",function(t,e){var i=this.toString();for(t-=i.length,e=(e||" ")[0];t-- >0;)i+=e;return i}),String.prototype.$method("quotemeta",function(t){return this.replace(/([^0-9A-Za-z_])/g,"\\$1")}),String.prototype.$method("repeat",function(t){for(var e=Array(t),i=0;i<t;++i)e[i]=this;return e.join("")}),String.prototype.$method("count",function(t){var e=new RegExp(t,"gm");return this.match(e).length}),String.prototype.$method("include",function(t){return this.indexOf(t)!=-1}),String.prototype.$method("each",function(){return Array.prototype.forEach.apply(this,arguments),this}),String.prototype.$method("toArray",function(){for(var t=[],e=0,i=this.length;e<i;++e)t.push(this[e]);return t}),String.prototype.$method("toObject",function(t,e){t=t||"&",e=e||"=";var i={},n=this.split(t);return n.each(function(t,n){var s=t.indexOf(e);if(s>0){var r=t.substring(0,s),a=t.substring(s+1),o=Number(a);isNaN(o)?"true"===a?a=!0:"false"===a&&(a=!1):a=o,i[r]=a}}),i});var t="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ");String.prototype.$method("toCRC32",function(){var e=0,i=0,n=0;e^=-1;for(var s=0,r=this.length;s<r;++s)n=255&(e^this.charCodeAt(s)),i="0x"+t[n],e=e>>>8^i;return(e^-1)>>>0})}(),function(){Array.prototype.accessor("first",{get:function(){return this[0]},set:function(t){this[0]=t}}),Array.prototype.accessor("last",{get:function(){return this[this.length-1]},set:function(t){this[this.length-1]=t}}),Array.prototype.$method("equals",function(t){if(this.length!==t.length)return!1;for(var e=0,i=this.length;e<i;++e)if(this[e]!==t[e])return!1;return!0}),Array.prototype.$method("deepEquals",function(t){if(this.length!==t.length)return!1;for(var e=0,i=this.length;e<i;++e){var n=this[e].deepEquals?this[e].deepEquals(t[e]):this[e]===t[e];if(n===!1)return!1}return!0}),Array.prototype.$method("contains",function(t,e){return this.indexOf(t,e)!=-1}),Array.prototype.$method("at",function(t){return t%=this.length,t+=this.length,t%=this.length,this[t]}),Array.prototype.$method("find",function(t,e){var i=null;return this.some(function(n,s){if(t.call(e,n,s,this))return i=n,!0}),i}),Array.prototype.$method("findIndex",function(t,e){var i=null;return this.some(function(n,s){if(t.call(e,n,s,this))return i=s,!0}),i}),Array.prototype.$method("swap",function(t,e){var i=this[t];return this[t]=this[e],this[e]=i,this}),Array.prototype.$method("erase",function(t){var e=this.indexOf(t);return e>=0&&this.splice(e,1),this}),Array.prototype.$method("eraseAll",function(t){for(var e=0,i=this.length;e<i;++e)this[e]==t&&this.splice(e--,1);return this}),Array.prototype.$method("eraseIf",function(t){for(var e=0,i=this.length;e<i;++e)if(t(this[e],e,this)){this.splice(e,1);break}return this}),Array.prototype.$method("eraseIfAll",function(t){for(var e=0,i=this.length;e<i;++e)t(this[e],e,this)&&(this.splice(e--,1),i--);return this}),Array.prototype.$method("random",function(t,e){return t=t||0,e=e||this.length-1,this[Math.randint(t,e)]}),Array.prototype.$method("pickup",function(t,e){return t=t||0,e=e||this.length-1,this[Math.randint(t,e)]}),Array.prototype.$method("lot",function(t,e){return t=t||0,e=e||this.length-1,this[Math.randint(t,e)]}),Array.prototype.$method("uniq",function(t){return this.filter(function(t,e,i){return i.indexOf(t)===e})}),Array.prototype.$method("flatten",function(t){var e=null;if(t){e=this;for(var i=0;i<t;++i)e=Array.prototype.concat.apply([],e)}else e=this.reduce(function(t,e){return Array.isArray(e)?t.concat(e.flatten()):t.concat(e)},[]);return e}),Array.prototype.$method("clone",function(t){if(t===!0){for(var e=Array(this.length),i=0,n=this.length;i<n;++i)e[i]=this[i].clone?this[i].clone(t):this[i];return e}return Array.prototype.slice.apply(this)}),Array.prototype.$method("clear",function(){return this.length=0,this}),Array.prototype.$method("fill",function(t,e,i){e=e||0,i=i||this.length;for(var n=e;n<i;++n)this[n]=t;return this}),Array.prototype.$method("range",function(t,e,i){if(this.clear(),1==arguments.length)for(var n=0;n<t;++n)this[n]=n;else if(t<e){if(i=i||1,i>0)for(var n=t,s=0;n<e;n+=i,++s)this[s]=n}else if(i=i||-1,i<0)for(var n=t,s=0;n>e;n+=i,++s)this[s]=n;return this}),Array.prototype.$method("shuffle",function(){for(var t=0,e=this.length;t<e;++t){var i=Math.randint(0,e-1);t!=i&&this.swap(t,i)}return this}),Array.prototype.$method("sum",function(){for(var t=0,e=0,i=this.length;e<i;++e)t+=this[e];return t}),Array.prototype.$method("average",function(){for(var t=0,e=this.length,i=0;i<e;++i)t+=this[i];return t/e}),Array.prototype.$method("each",function(){return this.forEach.apply(this,arguments),this}),Array.prototype.$method("toULElement",function(){}),Array.prototype.$method("toOLElement",function(){}),Array.$method("range",function(t,e,i){return Array.prototype.range.apply([],arguments)}),Array.$method("of",function(){return Array.prototype.slice.call(arguments)}),Array.$method("from",function(t,e,i){if(!Object(t).length)return[];var n=[];if(Symbol&&Symbol.iterator&&t[Symbol.iterator]){for(var s=t[Symbol.iterator]();;){var r=s.next();if(r.done)break;var a="function"==typeof e?e.bind(i||this)(r.value):r.value;n.push(a)}return n}for(var o=0,h=t.length;o<h;o++)n.push(t[o]);return n.map("function"==typeof e?e:function(t){return t},i)}),Array.prototype.$method("most",function(t,e){if(this.length<1)return{max:-(1/0),min:1/0};if(t){var i=-(1/0),n=1/0,s=0,r=0;"undefined"==typeof e&&(e=this);for(var a=0,o=this.length;a<o;++a){var h=t.call(e,this[a],a,this);i<h&&(i=h,s=a),n>h&&(n=h,r=a)}return{max:this[s],min:this[r]}}for(var u=-(1/0),c=1/0,a=0,o=this.length;a<o;++a)u<this[a]&&(u=this[a]),c>this[a]&&(c=this[a]);return{max:u,min:c}})}(),function(){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.prototype.$method("format",function(i){var n=this.getFullYear(),s=this.getMonth(),r=this.getDate(),a=this.getDay(),o=this.getHours(),h=this.getMinutes(),u=this.getSeconds(),c=(this.getMilliseconds(),{yyyy:String(n).padding(4,"0"),yy:n.toString().substr(2,2),y:n,MMMM:t[s],MMM:t[s].substr(0,3),MM:String(s+1).padding(2,"0"),M:s+1,dd:String(r).padding(2,"0"),d:r,EEEE:e[a],EEE:e[a].substr(0,3),HH:String(o).padding(2,"0"),H:o,mm:String(h).padding(2,"0"),m:h,ss:String(u).padding(2,"0"),s:u}),p="("+Object.keys(c).join("|")+")",l=new RegExp(p,"g");return i.replace(l,function(t){return c[t]})}),Date.$method("calculateAge",function(t,e){"string"==typeof t&&(t=new Date(t)),e?"string"==typeof e&&(e=new Date(e)):e=new Date;var i=new Date(t.getTime()).setFullYear(256),n=new Date(e.getTime()).setFullYear(256),s=n<i?1:0;return e.getFullYear()-t.getFullYear()-s})}(),function(){Math.DEG_TO_RAD=Math.PI/180,Math.RAD_TO_DEG=180/Math.PI,Math.PHI=(1+Math.sqrt(5))/2,Math.degToRad=function(t){return t*Math.DEG_TO_RAD},Math.radToDeg=function(t){return t*Math.RAD_TO_DEG},Math.$method("clamp",function(t,e,i){return t<e?e:t>i?i:t}),Math.$method("inside",function(t,e,i){return t>=e&&t<=i}),Math.$method("randint",function(t,e){return Math.floor(Math.random()*(e-t+1))+t}),Math.$method("randfloat",function(t,e){return Math.random()*(e-t)+t}),Math.$method("randbool",function(t){return Math.randint(0,100)<(t||50)})}();var phina=phina||{};!function(){phina.VERSION="1.0.0",phina.$method("isNode",function(){return"undefined"!=typeof module}),phina.$method("namespace",function(t){t.call(this)});var t=phina.isNode()?global:window;phina.accessor("global",{get:function(){return t}}),phina.$method("testUA",function(t){if(!phina.global.navigator)return!1;var e=phina.global.navigator.userAgent;return t.test(e)}),phina.$method("isAndroid",function(){return phina.testUA(/Android/)}),phina.$method("isIPhone",function(){return phina.testUA(/iPhone/)}),phina.$method("isIPad",function(){return phina.testUA(/iPad/)}),phina.$method("isIOS",function(){return phina.testUA(/iPhone|iPad/)}),phina.$method("isMobile",function(){return phina.testUA(/iPhone|iPad|Android/)}),phina.isNode()&&(module.exports=phina),t.phina=phina}(this),phina.namespace(function(){phina.$method("createClass",function(t){var e=function(){var t=new e.prototype._creator;return e.prototype.init.apply(t,arguments),t};t.superClass&&(e.prototype=Object.create(t.superClass.prototype),t.init.owner=e,e.prototype.superInit=function(){this.__counter=this.__counter||0;var t=this._hierarchies[this.__counter++],e=t.prototype.init;e.apply(this,arguments),this.__counter=0},e.prototype.superMethod=function(){var t=Array.prototype.slice.call(arguments,0),e=t.shift();this.__counters=this.__counters||{},this.__counters[e]=this.__counters[e]||0;var i=this._hierarchies[this.__counters[e]++],n=i.prototype[e],s=n.apply(this,t);return this.__counters[e]=0,s},e.prototype.constructor=e),e.prototype.$extend(t),e.prototype._hierarchies=[];for(var i=e.prototype.superClass;i;)e.prototype._hierarchies.push(i),i=i.prototype.superClass;return t._accessor&&t._accessor.forIn(function(t,i){e.prototype.accessor(t,i)}),e.prototype._creator=function(){return this},e.prototype._creator.prototype=e.prototype,t._static&&e.$extend(t._static),t._defined&&t._defined.call(e,e),e});phina.$method("using",function(t){if(!t)return phina.global;var e=t.split(/[,.\/ ]|::/),i=phina.global;return e.forEach(function(t){i=i[t]||(i[t]={})}),i}),phina.$method("register",function(t,e){var i=t.split(/[,.\/ ]|::/),n=i.last,s=t.substring(0,t.lastIndexOf(".")),r=phina.using(s);return r[n]=e,e});var t={};phina.$method("define",function(e,i){if(i.superClass)if("string"==typeof i.superClass){var n=phina.using(i.superClass);if("function"!=typeof n)return t[i.superClass]||(t[i.superClass]=[]),void t[i.superClass].push(function(){phina.define(e,i)});i.superClass=n}else i.superClass=i.superClass;var s=phina.createClass(i);return s.prototype.accessor("className",{get:function(){return e}}),phina.register(e,s),t[e]&&(t[e].forEach(function(t){t()}),t[e]=null),s}),phina.$method("globalize",function(){phina.forIn(function(t,e){"object"==typeof e&&e.forIn(function(t,e){phina.global[t]=e})})}),phina._mainListeners=[],phina._mainLoaded=!1,phina.$method("main",function(t){phina._mainLoaded?t():phina._mainListeners.push(t)});var e=phina.global.document;phina.global.addEventListener&&e&&"complete"!==e.readyState?phina.global.addEventListener("load",function(){var t=function(){var e=phina._mainListeners.clone();phina._mainListeners.clear(),e.each(function(t){t()}),phina._mainListeners.length>0?t(0):phina._mainLoaded=!0};setTimeout(t)}):phina._mainLoaded=!0}),function(){phina.global.Event&&(Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()})}(),function(){phina.global.MouseEvent&&(MouseEvent.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),MouseEvent.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top}))}(),function(){phina.global.TouchEvent&&(TouchEvent.prototype.getter("pointX",function(){return this.touches[0].clientX-this.target.getBoundingClientRect().left}),TouchEvent.prototype.getter("pointY",function(){return this.touches[0].clientY-this.target.getBoundingClientRect().top}))}(),function(){phina.global.Touch&&(Touch.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),Touch.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top}))}(),phina.namespace(function(){phina.define("phina.util.EventDispatcher",{init:function(){this._listeners={}},on:function(t,e){return void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e),this},off:function(t,e){var i=this._listeners[t],n=i.indexOf(e);return n!=-1&&i.splice(n,1),this},fire:function(t){t.target=this;var e="on"+t.type;this[e]&&this[e](t);var i=this._listeners[t.type];if(i)for(var n=i.clone(),s=0,r=n.length;s<r;++s)n[s].call(this,t);return this},flare:function(t,e){var i={type:t};return e&&e.forIn(function(t,e){i[t]=e}),this.fire(i),this},one:function(t,e){var i=this,n=function(){var s=e.apply(i,arguments);return i.off(t,n),s};return this.on(t,n),this},has:function(t){return void 0!==this._listeners[t]&&0!==this._listeners[t].length||!!this["on"+t]},clear:function(t){var e="on"+t;return this[e]&&delete this[e],this._listeners[t]=[],this}}),function(){var t={addEventListener:"on",removeEventListener:"off",clearEventListener:"clear",hasEventListener:"has",dispatchEvent:"fire",dispatchEventByType:"flare"};t.forIn(function(t,e){phina.util.EventDispatcher.prototype.$method(t,phina.util.EventDispatcher.prototype[e])})}()}),phina.namespace(function(){phina.define("phina.asset.Asset",{superClass:"phina.util.EventDispatcher",serverError:!1,notFound:!1,loadError:!1,init:function(t){this.superInit(),this.loaded=!1},load:function(t){return this.src=t,phina.util.Flow(this._load.bind(this))},isLoaded:function(){return this.loaded},_load:function(t){var e=this;setTimeout(function(){e.loaded=!0,t()},100)},loadDummy:function(){}})}),phina.namespace(function(){phina.define("phina.asset.AssetManager",{_static:{assets:{image:{},sound:{},spritesheet:{}},get:function(t,e){return this.assets[t]&&this.assets[t][e]},set:function(t,e,i){this.assets[t]||(this.assets[t]={}),this.assets[t][e]=i},contains:function(t,e){}}})}),function(){phina.define("phina.util.Flow",{superClass:"phina.util.EventDispatcher",init:function(t,e){if(this.superInit(),this.status="pending",this.resultValue=null,this._queue=[],this.func=t,e!==!0){var i=this,n=function(){i.resolve.apply(i,arguments),i.status="resolved"},s=function(){i.reject.apply(i,arguments),i.status="rejected"};this.func(n,s)}},resolve:function(t){this.resultValue=t,this._queue.each(function(t){t(this.resultValue)},this),this._queue.clear()},reject:function(){},then:function(t){if("resolved"===this.status){var e=t(this.resultValue);return phina.util.Flow.resolve(e)}var i=phina.util.Flow(function(t){t()},!0);return this._queue.push(function(e){var n=t(e);n instanceof phina.util.Flow?n.then(function(t){i.resolve(t)}):i.resolve(e)}),i},_static:{resolve:function(t){if(t instanceof phina.util.Flow)return t;var e=phina.util.Flow(function(e){e(t)});return e},all:function(t){return phina.util.Flow(function(e){var i=0,n=[];t.each(function(s){s.then(function(s){++i,n.push(s),i>=t.length&&e(n)})})})}}})}(),phina.namespace(function(){phina.define("phina.util.Support",{_static:{canvas:!!phina.global.CanvasRenderingContext2D,webGL:function(){return!!phina.global.CanvasRenderingContext2D&&!!document.createElement("canvas").getContext("webgl")}(),webAudio:!!phina.global.AudioContext||!!phina.global.webkitAudioContext||!!phina.global.mozAudioContext}})}),phina.namespace(function(){phina.define("phina.graphics.Canvas",{domElement:null,canvas:null,context:null,init:function(t){"string"==typeof t?this.canvas=document.querySelector(t):this.canvas=t||document.createElement("canvas"),this.domElement=this.canvas,this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},setSize:function(t,e){return this.canvas.width=t,this.canvas.height=e,this},setSizeToScreen:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.setSize(window.innerWidth,window.innerHeight)},fitScreen:function(t){t=void 0===t||t;var e=function(){var t=this.domElement,e=t.style;e.position="absolute",e.margin="auto",e.left="0px",e.top="0px",e.bottom="0px",e.right="0px";var i=t.width/window.innerWidth,n=t.height/window.innerHeight,s=t.height/t.width;i>n?(e.width=Math.floor(innerWidth)+"px",e.height=Math.floor(innerWidth*s)+"px"):(e.width=Math.floor(innerHeight/s)+"px",e.height=Math.floor(innerHeight)+"px")}.bind(this);e(),t&&phina.global.addEventListener("resize",e,!1)},clear:function(t,e,i,n){return t=t||0,e=e||0,i=i||this.width,n=n||this.height,this.context.clearRect(t,e,i,n),this},clearColor:function(t,e,i,n,s){e=e||0,i=i||0,n=n||this.width,s=s||this.height;var r=this.context;return r.save(),r.setTransform(1,0,0,1,0,0),r.fillStyle=t,r.fillRect(e,i,n,s),r.restore(),this},beginPath:function(){return this.context.beginPath(),this},closePath:function(){return this.context.closePath(),this},moveTo:function(t,e){return this.context.moveTo(t,e),this},lineTo:function(t,e){return this.context.lineTo(t,e),this},quadraticCurveTo:function(){return this.context.quadraticCurveTo.apply(this.context,arguments),this},bezierCurveTo:function(){return this.context.bezierCurveTo.apply(this.context,arguments),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},clip:function(){return this.context.clip(),this},drawPoint:function(t,e){return this.strokeRect(t,e,1,1)},line:function(t,e,i,n){return this.moveTo(t,e).lineTo(i,n)},drawLine:function(t,e,i,n){return this.beginPath().line(t,e,i,n).stroke()},drawDashLine:function(t,e,i,n,s){var r=null;"string"==typeof s?r=s:(s=s||61680,r=s.toString(2)),r=r.padding(16,"1");var a=i-t,o=n-e,h=Math.sqrt(a*a+o*o);a/=h,o/=h;for(var u=t,c=e,p=0;p<h;++p)"1"==r[p%16]&&this.drawPoint(u,c),u+=a,c+=o;return this},drawArrow:function(t,e,i,n,s){var r=i-t,a=n-e,o=180*Math.atan2(a,r)/Math.PI;return this.drawLine(t,e,i,n),this.fillPolygon(i,n,s||5,3,o),this},lines:function(){this.moveTo(arguments[0],arguments[1]);for(var t=1,e=arguments.length/2;t<e;++t)this.lineTo(arguments[2*t],arguments[2*t+1]);return this},strokeLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.stroke(),this},fillLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.fill(),this},rect:function(t,e,i,n){return this.context.rect.apply(this.context,arguments),this},fillRect:function(){return this.context.fillRect.apply(this.context,arguments),this},strokeRect:function(){return this.context.strokeRect.apply(this.context,arguments),this},roundRect:function(t,e,i,n,s){var r=t+s,a=t+i-s,o=e+s,h=e+n-s;return this.context.arc(r,o,s,-Math.PI,.5*-Math.PI,!1),this.context.arc(a,o,s,.5*-Math.PI,0,!1),this.context.arc(a,h,s,0,.5*Math.PI,!1),this.context.arc(r,h,s,.5*Math.PI,Math.PI,!1),this.closePath(),this},fillRoundRect:function(t,e,i,n,s){return this.beginPath().roundRect(t,e,i,n,s).fill()},strokeRoundRect:function(t,e,i,n,s){return this.beginPath().roundRect(t,e,i,n,s).stroke()},circle:function(t,e,i){return this.context.arc(t,e,i,0,2*Math.PI,!1),this},fillCircle:function(t,e,i){var n=this.context;return n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.closePath(),n.fill(),this},strokeCircle:function(t,e,i){var n=this.context;return n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.closePath(),n.stroke(),this},arc:function(t,e,i,n,s,r){return this.context.arc(t,e,i,n,s,r),this},fillArc:function(t,e,i,n,s,r){return this.beginPath().arc(t,e,i,n,s,r).fill()},strokeArc:function(t,e,i,n,s,r){return this.beginPath().arc(t,e,i,n,s,r).stroke()},pie:function(t,e,i,n,s,r){var a=this.context;return a.beginPath(),a.moveTo(0,0),a.arc(t,e,i,n,s,r),a.closePath(),this},fillPie:function(t,e,i,n,s,r){return this.beginPath().pie(t,e,i,n,s,r).fill()},strokePie:function(t,e,i,n,s,r){return this.beginPath().pie(t,e,i,n,s,r).stroke()},polygon:function(t,e,i,n,s){var r=2*Math.PI/n,a=void 0!==s?s*Math.PI/180:-Math.PI/2;this.moveTo(t+Math.cos(a)*i,e+Math.sin(a)*i);for(var o=1;o<n;++o){var h=r*o+a;this.lineTo(t+Math.cos(h)*i,e+Math.sin(h)*i)}return this.closePath(),this},fillPolygon:function(t,e,i,n,s){return this.beginPath().polygon(t,e,i,n,s).fill()},strokePolygon:function(t,e,i,n,s){return this.beginPath().polygon(t,e,i,n,s).stroke()},star:function(t,e,i,n,s,r){var t=t||0,e=e||0,i=i||64,n=n||5,a=i*(s||.38),o=r?r*Math.PI/180:-Math.PI/2,h=2*Math.PI/n/2;this.moveTo(t+Math.cos(o)*i,e+Math.sin(o)*i);for(var u=1;u<2*n;++u){var c=h*u+o,p=u%2?a:i;this.lineTo(t+Math.cos(c)*p,e+Math.sin(c)*p)}return this.closePath(),this},fillStar:function(t,e,i,n,s,r){return this.beginPath().star(t,e,i,n,s,r).fill(),this},strokeStar:function(t,e,i,n,s,r){return this.beginPath().star(t,e,i,n,s,r).stroke(),this},heart:function(t,e,i,n){var s=.5*i,r=void 0===n?Math.PI/4:Math.degToRad(n),a=Math.cos(r)*s,o=Math.sin(r)*s,h=-s,u=(s*s-a*h)/o,c=u+s,p=s-c/2;return this.moveTo(0+t,u+e+p),this.arc(-s+t,0+e+p,s,Math.PI-r,2*Math.PI),this.arc(s+t,0+e+p,s,Math.PI,r),this.closePath(),this},fillHeart:function(t,e,i,n){return this.beginPath().heart(t,e,i,n).fill()},strokeHeart:function(t,e,i,n){return this.beginPath().heart(t,e,i,n).stroke()},ellipse:function(t,e,i,n){var s=this.context,r=.5522848,a=i/2*r,o=n/2*r,h=t+i,u=e+n,c=t+i/2,p=e+n/2;return s.moveTo(t,p),s.bezierCurveTo(t,p-o,c-a,e,c,e),s.bezierCurveTo(c+a,e,h,p-o,h,p),s.bezierCurveTo(h,p+o,c+a,u,c,u),s.bezierCurveTo(c-a,u,t,p+o,t,p),this},fillEllipse:function(t,e,i,n){return this.beginPath().ellipse(t,e,i,n).fill()},strokeEllipse:function(t,e,i,n){return this.beginPath().ellipse(t,e,i,n).stroke()},fillText:function(){return this._context.fillText.apply(this._context,arguments),this},strokeText:function(){return this._context.strokeText.apply(this._context,arguments),this},drawImage:function(){this.context.drawImage.apply(this.context,arguments)},setTransform:function(t,e,i,n,s,r){return this.context.setTransform(t,e,i,n,s,r),this},resetTransform:function(){return this.setTransform(1,0,0,1,0,0),this},transformCenter:function(){return this.context.setTransform(1,0,0,1,this.width/2,this.height/2),this},translate:function(t,e){return this.context.translate(t,e),this},rotate:function(t){return this.context.rotate(t),this},scale:function(t,e){return this.context.scale(t,e),this},save:function(){return this.context.save(),this},restore:function(){return this.context.restore(),this},saveAsImage:function(t){t=t||"image/png";var e=this.canvas.toDataURL(t);window.open(e,"save")},_accessor:{width:{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},height:{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}},fillStyle:{get:function(){return this.context.fillStyle},set:function(t){this.context.fillStyle=t}},strokeStyle:{get:function(){return this.context.strokeStyle},set:function(t){this.context.strokeStyle=t}},globalAlpha:{get:function(){return this.context.globalAlpha},set:function(t){this.context.globalAlpha=t}},globalCompositeOperation:{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}},shadowBlur:{get:function(){return this.context.shadowBlur},set:function(t){this.context.shadowBlur=t}},shadowColor:{get:function(){return this.context.shadowColor},set:function(t){this.context.shadowColor=t}},shadowOffsetX:{get:function(){return this.context.shadowOffsetX},set:function(t){this.context.shadowOffsetX=t}},shadowOffsetY:{get:function(){return this.context.shadowOffsetY},set:function(t){this.context.shadowOffsetY=t}},lineCap:{get:function(){return this.context.lineCap},set:function(t){this.context.lineCap=t}},lineJoin:{get:function(){return this.context.lineJoin},set:function(t){this.context.lineJoin=t}},miterLimit:{get:function(){return this.context.miterLimit},set:function(t){this.context.miterLimit=t}},lineWidth:{get:function(){return this.context.lineWidth},set:function(t){this.context.lineWidth=t}},font:{get:function(){return this.context.font},set:function(t){this.context.font=t}},textAlign:{get:function(){return this.context.textAlign},set:function(t){
this.context.textAlign=t}},textBaseline:{get:function(){return this.context.textBaseline},set:function(t){this.context.textBaseline=t}},imageSmoothingEnabled:{get:function(){return this.context.imageSmoothingEnabled},set:function(t){this.context.imageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.mozImageSmoothingEnabled=t}}},_static:{_context:function(){return phina.util.Support.canvas?document.createElement("canvas").getContext("2d"):null}(),measureText:function(t,e){return this._context.font=t,this._context.measureText(e)},createLinearGradient:function(){return this._context.createLinearGradient.apply(this._context,arguments)},createRadialGradient:function(){return this._context.createRadialGradient.apply(this._context,arguments)}}})}),phina.namespace(function(){phina.define("phina.asset.Texture",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){this.domElement=new Image;var e="file:"==location.protocol;!e&&!/^data:/.test(this.src);var i=this;this.domElement.onload=function(e){i.loaded=!0,t(i)},this.domElement.onerror=function(t){console.error("[phina.js] not found `{0}`!".format(this.src));var e=i.src.split("/").last.replace(".png","").split("?").first.split("#").first;t.target.onerror=null,t.target.src="http://dummyimage.com/128x128/444444/eeeeee&text="+e},this.domElement.src=this.src},clone:function(){var t=this.domElement,e=phina.graphics.Canvas().setSize(t.width,t.height),i=phina.asset.Texture();return e.context.drawImage(t,0,0),i.domElement=e.domElement,i},transmit:function(t){var e=this.domElement,i=phina.graphics.Canvas().setSize(e.width,e.height);i.context.drawImage(e,0,0);var n=i.context.getImageData(0,0,i.width,i.height),s=n.data,r=void 0!==t?t.r:s[0],a=void 0!==t?t.g:s[1],o=void 0!==t?t.b:s[2];3..step(s.length,4,function(t){s[t-3]===r&&s[t-2]===a&&s[t-1]===o&&(s[t]=0)}),i.context.putImageData(n,0,0),this.domElement=i.domElement},filter:function(t){if(!t)return this;Array.isArray(t)||(t=[t]);var e=this.domElement,i=e.width,n=e.height,s=phina.graphics.Canvas().setSize(i,n),r=null;return s.context.drawImage(e,0,0),r=s.context.getImageData(0,0,i,n),t.forEach(function(t){"function"==typeof t&&n.times(function(e){i.times(function(n){var s=4*(e*i+n),a=r.data.slice(s,s+4);t(a,s,n,e,r)})})}),s.context.putImageData(r,0,0),this.domElement=s.domElement,this}})}),phina.namespace(function(){phina.define("phina.asset.Sound",{superClass:"phina.asset.Asset",_loop:!1,_loopStart:0,_loopEnd:0,_playbackRate:1,init:function(){this.superInit(),this.context=phina.asset.Sound.getAudioContext(),this.gainNode=this.context.createGain()},play:function(t,e,i){t=t?t+this.context.currentTime:0,e=e||0,this.source;var n=this.source=this.context.createBufferSource();n.buffer=this.buffer;return n.loop=this._loop,n.loopStart=this._loopStart,n.loopEnd=this._loopEnd,n.playbackRate.value=this._playbackRate,n.connect(this.gainNode),this.gainNode.connect(phina.asset.Sound.getMasterGain()),void 0!==i?n.start(t,e,i):n.start(t,e),n.addEventListener("ended",function(){this.flare("ended")}.bind(this)),this},stop:function(){return this.source&&(this.source.stop&&this.source.stop(0),this.source=null,this.flare("stop")),this},pause:function(){return this.source.playbackRate.value=0,this.flare("pause"),this},resume:function(){return this.source.playbackRate.value=this._playbackRate,this.flare("resume"),this},_oscillator:function(t){var e=this.context,i=e.createOscillator();i.type=t||"sine",this.source=i,this.source.connect(e.destination)},loadFromBuffer:function(t){var e=this.context;if(!t){t=e.createBuffer(1,44100,44100);for(var i=t.getChannelData(0),n=0;n<i.length;n++)i[n]=Math.sin(n/100*Math.PI)}this.buffer=t},setLoop:function(t){return this.loop=t,this},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},setPlaybackRate:function(t){return this.playbackRate=t,this},_load:function(t){/^data:/.test(this.src)?this._loadFromURIScheme(t):this._loadFromFile(t)},_loadFromFile:function(t){var e=this,i=new XMLHttpRequest;i.open("GET",this.src),i.onreadystatechange=function(){if(4===i.readyState)if([200,201,0].indexOf(i.status)!==-1){var n=i.response;e.context.decodeAudioData(n,function(i){e.loadFromBuffer(i),t(e)},function(){console.warn("音声ファイルのデコードに失敗しました。("+e.src+")"),t(e),e.flare("decodeerror")})}else 404===i.status?(e.loadError=!0,e.notFound=!0,t(e),e.flare("loaderror"),e.flare("notfound")):(e.loadError=!0,e.serverError=!0,t(e),e.flare("loaderror"),e.flare("servererror"))},i.responseType="arraybuffer",i.send(null)},_loadFromURIScheme:function(t){var e="";e=this.src.split(",")[0].indexOf("base64")>=0?atob(this.src.split(",")[1]):unescape(this.src.split(",")[1]);for(var i=this,n=e.length,s=new Uint8Array(n),r=0;r<n;++r)s[r]=e.charCodeAt(r);this.context.decodeAudioData(s.buffer,function(e){i.loadFromBuffer(e),t(i)},function(){console.warn("音声ファイルのデコードに失敗しました。("+i.src+")"),i.loaded=!0,t(i)})},loadDummy:function(){this.loadFromBuffer()},_accessor:{volume:{get:function(){return this.gainNode.gain.value},set:function(t){this.gainNode.gain.value=t}},loop:{get:function(){return this._loop},set:function(t){this._loop=t,this.source&&(this.source._loop=t)}},loopStart:{get:function(){return this._loopStart},set:function(t){this._loopStart=t,this.source&&(this.source._loopStart=t)}},loopEnd:{get:function(){return this._loopEnd},set:function(t){this._loopEnd=t,this.source&&(this.source._loopEnd=t)}},playbackRate:{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this.source&&0!==this.source.playbackRate.value&&(this.source.playbackRate.value=t)}}},_defined:function(){this.accessor("volume",{get:function(){return this.getMasterGain().gain.value},set:function(t){this.getMasterGain().gain.value=t}})},_static:{getMasterGain:function(){if(!this._masterGain){var t=this.getAudioContext();this._masterGain=t.createGain(),this._masterGain.connect(t.destination)}return this._masterGain},getAudioContext:function(){if(!phina.util.Support.webAudio)return null;if(this.context)return this.context;var t=phina.global,e=null;return t.AudioContext?e=new AudioContext:t.webkitAudioContext?e=new webkitAudioContext:t.mozAudioContext&&(e=new mozAudioContext),this.context=e,e}}})}),phina.namespace(function(){phina.define("phina.asset.SpriteSheet",{superClass:"phina.asset.Asset",init:function(){this.superInit()},setup:function(t){return this._setupFrame(t.frame),this._setupAnim(t.animations),this},_load:function(t){var e=this;if("string"==typeof this.src){var i=new XMLHttpRequest;i.open("GET",this.src),i.onreadystatechange=function(){if(4===i.readyState&&[200,201,0].indexOf(i.status)!==-1){var n=i.responseText,s=JSON.parse(n);e.setup(s),t(e)}},i.send(null)}else this.setup(this.src),t(e)},_setupFrame:function(t){var e=this.frames=[],i=t.width,n=t.height,s=t.rows*t.cols;this.frame=s,s.times(function(s){var r=s%t.cols,a=s/t.cols|0;e.push({x:r*i,y:a*n,width:i,height:n})})},_setupAnim:function(t){this.animations={},this.animations.default={frames:[].range(0,this.frame),next:"default",frequency:1},t.forIn(function(t,e){var i=e;i instanceof Array?this.animations[t]={frames:[].range(i[0],i[1]),next:i[2],frequency:i[3]||1}:this.animations[t]={frames:i.frames,next:i.next,frequency:i.frequency||1}},this)},getFrame:function(t){return this.frames[t]},getAnimation:function(t){return t=void 0!==t?t:"default",this.animations[t]}})}),phina.namespace(function(){phina.define("phina.asset.Script",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){var e=this;this.domElement=document.createElement("script"),this.domElement.src=this.src,this.domElement.onload=function(){t(e)}.bind(this),document.body.appendChild(this.domElement)}})}),phina.namespace(function(){phina.define("phina.asset.Font",{superClass:"phina.asset.Asset",init:function(){this.superInit(),this.fontName=null},load:function(t){this.src=t;var e=/(.*)(?:\.([^.]+$))/,i=this.fontName||t.match(e)[1].split("/").last,n=t.match(e)[2],s="unknown";switch(n){case"ttf":s="truetype";break;case"otf":s="opentype";break;case"woff":s="woff";break;case"woff2":s="woff2";break;default:console.warn("サポートしていないフォント形式です。("+t+")")}if(this.format=s,this.fontName=i,"unknown"!==s){var r="@font-face { font-family: '{0}'; src: url({1}) format('{2}'); }".format(i,t,s),a=document.querySelector("head"),o=document.createElement("style");o.innerText?o.innerText=r:o.textContent=r,a.appendChild(o)}return phina.util.Flow(this._load.bind(this))},_load:function(t){"unknown"!==this.format?this._checkLoaded(this.fontName,function(){this.loaded=!0,t(this)}.bind(this)):(this.loaded=!0,t(this))},_checkLoaded:function(t,e){var i=phina.graphics.Canvas(),n=i.context.font.split(" ")[1];i.context.font="40px "+n;var s="1234567890-^\\qwertyuiop@[asdfghjkl;:]zxcvbnm,./!\"#$%&'()=~|QWERTYUIOP`{ASDFGHJKL+*}ZXCVBNM<>?_１２３４５６７８９０－＾￥ｑｗｅｒｔｙｕｉｏｐａｓｄｆｇｈｊｋｌｚｘｃｖｂｎｍ，．あいうかさたなをん時は金なり";s+=String.fromCharCode("0xf04b");var r=i.context.measureText(s).width;i.context.font="40px "+t+", "+n;var a=30,o=function(){var t=i.context.measureText(s).width;t!==r?setTimeout(function(){e&&e()},100):--a>0?setTimeout(o,100):(e&&e(),console.warn("timeout font loading"))};o()},setFontName:function(t){return this.loaded?(console.warn("フォント名はLoad前にのみ設定が出来ます("+t+")"),this):(this.fontName=t,this)},getFontName:function(){return this.fontName}})}),phina.namespace(function(){phina.define("phina.asset.File",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){var e={};"string"==typeof this.src?e.$extend({path:this.src}):"object"==typeof this.src&&e.$extend(this.src),e.$safe({path:"",dataType:"text"});var i=this,n=new XMLHttpRequest;n.open("GET",e.path),n.onreadystatechange=function(){if(4===n.readyState&&[200,201,0].indexOf(n.status)!==-1){var s=n.responseText;"json"===e.dataType?s=JSON.parse(s):"xml"===e.dataType&&(s=(new DOMParser).parseFromString(s,"text/xml")),i.dataType=e.dataType,i.data=s,t(i)}},n.send(null)}})}),phina.namespace(function(){phina.define("phina.asset.AssetLoader",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),t=(t||{}).$safe({cache:!0}),this.assets={},this.cache=t.cache},load:function(t){var e=this,i=[],n=0,s=0;return t.forIn(function(t,e){s+=Object.keys(e).length}),t.forIn(function(t,r){r.forIn(function(r,a){var o=phina.asset.AssetLoader.assetLoadFunctions[t],h=o(r,a);h.then(function(i){e.cache&&phina.asset.AssetManager.set(t,r,i),e.flare("progress",{key:r,asset:i,progress:++n/s})}),i.push(h)})}),e.cache&&e.on("progress",function(e){e.progress>=1&&t.forIn(function(t,e){e.forIn(function(e,i){var n=phina.asset.AssetManager.get(t,e);if(n.loadError){var s=phina.asset.AssetManager.get(t,"dummy");s?(s.loadError&&(s.loadDummy(),s.loadError=!1),phina.asset.AssetManager.set(t,e,s)):n.loadDummy()}})})}),phina.util.Flow.all(i).then(function(t){e.flare("load")})},_static:{assetLoadFunctions:{image:function(t,e){var i=phina.asset.Texture(),n=i.load(e);return n},sound:function(t,e){var i=phina.asset.Sound(),n=i.load(e);return n},spritesheet:function(t,e){var i=phina.asset.SpriteSheet(),n=i.load(e);return n},script:function(t,e){var i=phina.asset.Script();return i.load(e)},font:function(t,e){var i=phina.asset.Font();return i.setFontName(t),i.load(e)},json:function(t,e){var i=phina.asset.File();return i.load({path:e,dataType:"json"})},xml:function(t,e){var i=phina.asset.File();return i.load({path:e,dataType:"xml"})},text:function(t,e){var i=phina.asset.File();return i.load(e)}},register:function(t,e){return this.assetLoadFunctions[t]=e,this}}})}),phina.namespace(function(){phina.define("phina.app.Element",{superClass:"phina.util.EventDispatcher",parent:null,children:null,awake:!0,init:function(){this.superInit(),this.children=[]},addChild:function(t){return t.parent&&t.remove(),t.parent=this,this.children.push(t),t.has("added")&&t.flare("added"),t},addChildTo:function(t){return t.addChild(this),this},addChildAt:function(t,e){return t.parent&&t.remove(),t.parent=this,this.children.splice(e,0,t),t.has("added")&&t.flare("added"),t},getChildAt:function(t){return this.children.at(t)},getChildByName:function(t){},getChildIndex:function(t){return this.children.indexOf(t)},getParent:function(){return this.parent},getRoot:function(){var t=this;for(t=this.parent;null!=t.parent;t=t.parent);return t},removeChild:function(t){var e=this.children.indexOf(t);return e!==-1&&(this.children.splice(e,1),t.has("removed")&&t.flare("removed")),this},remove:function(){if(this.parent)return this.parent.removeChild(this),this.parent=null,this},isAwake:function(){return this.awake},wakeUp:function(){return this.awake=!0,this},sleep:function(){return this.awake=!1,this},fromJSON:function(t){var e=function(t,e){var i=e.arguments;i=i instanceof Array?i:[i];var n=phina.using(e.className),s=n.apply(null,i);s.name=t,this[t]=s,s.fromJSON(e),s.addChildTo(this)}.bind(this);return t.forIn(function(t,i){"children"===t?i.forIn(function(t,i){e(t,i)}):"type"!==t&&"className"!==t&&(this[t]=i)},this),this},toJSON:function(){var t=Object.keys(phina.using(this.className).defaults||{});this._hierarchies.forEach(function(e){var i=e.defaults;i&&Object.keys(i).forEach(function(e){t.indexOf(e)===-1&&t.push(e)})}),t.push("name","className");var e={};t.each(function(t){e[t]=this[t]},this);var i=this.children.map(function(t){return t.toJSON()});return i.length&&(e.children={},i.each(function(t,i){e.children[t.name||t.className+"_"+i]=t})),e}})}),phina.namespace(function(){phina.define("phina.accessory.Accessory",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.target=t},setTarget:function(t){if(this.target!==t)return this.target=t,this},getTarget:function(){return this.target},isAttached:function(){return!!this.target},attachTo:function(t){return t.attach(this),this.setTarget(t),this},remove:function(){this.target.detach(this),this.target=null}}),phina.app.Element.prototype.$method("attach",function(t){return this.accessories||(this.accessories=[],this.on("enterframe",function(t){this.accessories.each(function(e){e.update&&e.update(t.app)})})),this.accessories.push(t),t.setTarget(this),t.flare("attached"),this}),phina.app.Element.prototype.$method("detach",function(t){return this.accessories&&(this.accessories.erase(t),t.setTarget(null),t.flare("detached")),this})}),function(){phina.define("phina.util.Tween",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.time=0},fromTo:function(t,e,i,n,s){this.target=t,this.beginProps=e,this.finishProps=i,this.duration=n||1e3,this.easing=s,this.changeProps={};for(var r in e)this.changeProps[r]=i[r]-e[r];return this},to:function(t,e,i,n){var s={};for(var r in e)s[r]=t[r];return this.fromTo(t,s,e,i,n),this},from:function(t,e,i,n){var s={};for(var r in e)s[r]=t[r],t[r]=e[r];return this.fromTo(t,e,s,i,n),this},by:function(t,e,i,n){var s={},r={};for(var a in e)s[a]=t[a],r[a]=t[a]+e[a];return this.fromTo(t,s,r,i,n),this},yoyo:function(){var t=this.beginProps;return this.beginProps=this.finishProps,this.finishProps=t,this.changeProps.forIn(function(t,e,i){this.changeProps[t]=-e,this.target[t]=this.beginProps[t]},this),this},gain:function(t){this.seek(this.time+t)},forward:function(t){this.seek(this.time+t)},backward:function(t){this.seek(this.time-t)},seek:function(t){return this.time=Math.clamp(t,0,this.duration),this.beginProps.forIn(function(t,e){var i=this.easing(this.time,e,this.changeProps[t],this.duration);this.target[t]=i},this),this},_accessor:{easing:{get:function(){return this._easing},set:function(t){this._easing=phina.util.Tween.EASING[t]||phina.util.Tween.EASING.default}}},_static:{EASING:{default:function(t,e,i,n){return i*t/n+e},linear:function(t,e,i,n){return i*t/n+e},swing:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeOutInCubic:function(t,e,i,n){return t<n/2?phina.util.Tween.EASING.easeOutCubic(2*t,e,i/2,n):phina.util.Tween.EASING.easeInCubic(2*t-n,e+i/2,i/2,n)},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeOutInQuart:function(t,e,i,n){return t<n/2?phina.util.Tween.EASING.easeOutQuart(2*t,e,i/2,n):phina.util.Tween.EASING.easeInQuart(2*t-n,e+i/2,i/2,n)},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeOutInQuint:function(t,e,i,n){return t<n/2?phina.util.Tween.EASING.easeOutQuint(2*t,e,i/2,n):phina.util.Tween.EASING.easeInQuint(2*t-n,e+i/2,i/2,n)},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeOutInSine:function(t,e,i,n){return t<n/2?phina.util.Tween.EASING.easeOutSine(2*t,e,i/2,n):phina.util.Tween.EASING.easeInSine(2*t-n,e+i/2,i/2,n)},easeInExpo:function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},easeOutExpo:function(t,e,i,n){return t==n?e+i:1.001*i*(-Math.pow(2,-10*t/n)+1)+e},easeInOutExpo:function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e-5e-4*i:i/2*1.0005*(-Math.pow(2,-10*--t)+2)+e},easeOutInExpo:function(t,e,i,n){return t<n/2?phina.util.Tween.EASING.easeOutExpo(2*t,e,i/2,n):phina.util.Tween.EASING.easeInExpo(2*t-n,e+i/2,i/2,n)},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeOutInCirc:function(t,e,i,n){return t<n/2?phina.util.Tween.EASING.easeOutCirc(2*t,e,i/2,n):phina.util.Tween.EASING.easeInCirc(2*t-n,e+i/2,i/2,n)},easeInElastic:function(t,e,i,n,s,r){var a;return 0==t?e:1==(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),-(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r))+e)},easeOutElastic:function(t,e,i,n,s,r){var a;return 0==t?e:1==(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin((t*n-a)*(2*Math.PI)/r)+i+e)},easeInOutElastic:function(t,e,i,n,s,r){var a;return 0==t?e:2==(t/=n/2)?e+i:(r||(r=n*(.3*1.5)),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),t<1?-.5*(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r))+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r)*.5+i+e)},easeOutInElastic:function(t,e,i,n,s,r){return t<n/2?phina.util.Tween.EASING.easeOutElastic(2*t,e,i/2,n,s,r):phina.util.Tween.EASING.easeInElastic(2*t-n,e+i/2,i/2,n,s,r)},easeInBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),i*(t/=n)*t*((s+1)*t-s)+e},easeOutBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},easeInOutBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),(t/=n/2)<1?i/2*(t*t*(((s*=1.525)+1)*t-s))+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e},easeOutInBack:function(t,e,i,n,s){return t<n/2?phina.util.Tween.EASING.easeOutBack(2*t,e,i/2,n,s):phina.util.Tween.EASING.easeInBack(2*t-n,e+i/2,i/2,n,s)},easeInBounce:function(t,e,i,n){return i-phina.util.Tween.EASING.easeOutBounce(n-t,0,i,n)+e},easeOutBounce:function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,e,i,n){return t<n/2?.5*phina.util.Tween.EASING.easeInBounce(2*t,0,i,n)+e:.5*phina.util.Tween.EASING.easeOutBounce(2*t-n,0,i,n)+.5*i+e},easeOutInBounce:function(t,e,i,n){return t<n/2?phina.util.Tween.EASING.easeOutBounce(2*t,e,i/2,n):phina.util.Tween.EASING.easeInBounce(2*t-n,e+i/2,i/2,n)}}}})}(),phina.namespace(function(){var t=phina.define("phina.accessory.Tweener",{superClass:"phina.accessory.Accessory",updateType:"delta",init:function(t){this.superInit(t),this._init()},_init:function(){this._loop=!1,this._tasks=[],this._index=0,this.playing=!0,this._update=this._updateTask},update:function(t){this._update(t)},setUpdateType:function(t){return this.updateType=t,this},to:function(t,e,i){return this._add({type:"tween",mode:"to",props:t,duration:e,easing:i}),this},by:function(t,e,i){return this._add({type:"tween",mode:"by",props:t,duration:e,easing:i}),this},from:function(t,e,i){return this._add({type:"tween",mode:"from",props:t,duration:e,easing:i}),this},wait:function(t){return this._add({type:"wait",data:{limit:t}}),this},call:function(t,e,i){return this._add({type:"call",data:{func:t,self:e||this,args:i}}),this},set:function(t,e){var i=null;return 2==arguments.length?(i={},i[t]=e):i=t,this._tasks.push({type:"set",data:{values:i}}),this},moveTo:function(t,e,i,n){return this.to({x:t,y:e},i,n)},moveBy:function(t,e,i,n){return this.by({x:t,y:e},i,n)},rotateTo:function(t,e,i){return this.to({rotation:t},e,i)},rotateBy:function(t,e,i){return this.by({rotation:t},e,i)},scaleTo:function(t,e,i){return this.to({scaleX:t,scaleY:t},e,i)},scaleBy:function(t,e,i){return this.by({scaleX:t,scaleY:t},e,i)},fade:function(t,e,i){return this.to({alpha:t},e,i)},fadeOut:function(t,e){return this.fade(0,t,e)},fadeIn:function(t,e){return this.fade(1,t,e)},play:function(){return this.playing=!0,this},pause:function(){return this.playing=!1,this},stop:function(){return this.playing=!1,this.rewind(),this},rewind:function(){return this._update=this._updateTask,this._index=0,this},yoyo:function(){return this._update=this._updateTask,this._index=0,this._tasks.each(function(t){"tween"===t.type}),this.play(),this},setLoop:function(t){return this._loop=t,this},clear:function(){return this._init(),this},fromJSON:function(t){return void 0!==t.loop&&this.setLoop(t.loop),t.tweens.each(function(t){t=t.clone();var e=t.shift();this[e].apply(this,t)},this),this},_add:function(t){this._tasks.push(t)},_updateTask:function(t){if(this.playing){var e=this._tasks[this._index];if(!e)return void(this._loop?(this.rewind(),this._update(t)):this.playing=!1);if(++this._index,"tween"===e.type){this._tween=phina.util.Tween();var i=e.duration||this._getDefaultDuration();"to"===e.mode?this._tween.to(this.target,e.props,i,e.easing):"by"===e.mode?this._tween.by(this.target,e.props,i,e.easing):this._tween.from(this.target,e.props,i,e.easing),this._update=this._updateTween,this._update(t)}else"wait"===e.type?(this._wait={time:0,limit:e.data.limit},this._update=this._updateWait,this._update(t)):"call"===e.type?(e.data.func.apply(e.data.self,e.data.args),this._update(t)):"set"===e.type&&(this.target.$extend(e.data.values),this._update(t))}},_updateTween:function(t){var e=this._tween,i=this._getUnitTime(t);e.forward(i),this.flare("tween"),e.time>=e.duration&&(delete this._tween,this._tween=null,this._update=this._updateTask)},_updateWait:function(t){var e=this._wait,i=this._getUnitTime(t);e.time+=i,e.time>=e.limit&&(delete this._wait,this._wait=null,this._update=this._updateTask)},_getUnitTime:function(t){var i=e[this.updateType];return i?i.func(t):1e3/t.fps},_getDefaultDuration:function(){var t=e[this.updateType];return t&&t.duration},_static:{UPDATE_MAP:{normal:{func:function(t){return 1e3/t.fps},duration:1e3},delta:{func:function(t){return t.ticker.deltaTime},duration:1e3},fps:{func:function(t){return 1},duration:30}}}}),e=t.UPDATE_MAP;phina.app.Element.prototype.getter("tweener",function(){return this._tweener||(this._tweener=phina.accessory.Tweener().attachTo(this)),this._tweener})}),phina.namespace(function(){phina.define("phina.geom.Vector2",{x:0,y:0,init:function(t,e){this.x=t,this.y=e},clone:function(){return phina.geom.Vector2(this.x,this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},set:function(t,e){return this.x=t,this.y=e,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},mul:function(t){return this.x*=t,this.y*=t,this},div:function(t){return t=t||.01,this.x/=t,this.y/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},distanceSquared:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},random:function(t,e,i){var n=phina.util.Random.randfloat(t||0,e||360),s=n*Math.DEG_TO_RAD,i=i||1;return this.x=Math.cos(s)*i,this.y=Math.sin(s)*i,this},normalize:function(){return this.div(this.length()),this},toString:function(){return"{x:{x}, y:{y}}".format(this)},getDirection:function(){var t=this.toDegree();return t<45?"right":t<135?"down":t<225?"left":t<315?"up":"right"},toAngle:function(){var t=Math.atan2(this.y,this.x);return(t+2*Math.PI)%(2*Math.PI)},fromAngle:function(t,e){return e=e||1,this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this},toDegree:function(){return this.toAngle().toDegree()},fromDegree:function(t,e){return this.fromAngle(t.toRadian(),e)},rotate:function(t,e){e=e||phina.geom.Vector2(0,0);var i=this.x-e.x,n=this.y-e.y,s=i*Math.cos(t)-n*Math.sin(t),r=i*Math.sin(t)+n*Math.cos(t);return this.set(e.x+s,e.y+r),this},_accessor:{},_static:{min:function(t,e){return phina.geom.Vector2(t.x<e.x?t.x:e.x,t.y<e.y?t.y:e.y)},max:function(t,e){return phina.geom.Vector2(t.x>e.x?t.x:e.x,t.y>e.y?t.y:e.y)},add:function(t,e){return phina.geom.Vector2(t.x+e.x,t.y+e.y)},sub:function(t,e){return phina.geom.Vector2(t.x-e.x,t.y-e.y)},mul:function(t,e){return phina.geom.Vector2(t.x*e,t.y*e)},div:function(t,e){return phina.geom.Vector2(t.x/e,t.y/e)},negate:function(t){return phina.geom.Vector2(-t.x,-t.y)},dot:function(t,e){return t.x*e.x+t.y*e.y},cross:function(t,e){return t.x*e.y-t.y*e.x},distance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},distanceSquared:function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)},manhattanDistance:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},normal:function(t,e){var i=phina.geom.Vector2.sub(t,e);return phina.geom.Vector2(-i.y,i.x)},reflect:function(t,e){var i=phina.geom.Vector2.dot(t,e),n=phina.geom.Vector2.mul(e,2*i);return phina.geom.Vector2.sub(t,n)},wall:function(t,e){var i=phina.geom.Vector2.dot(t,e),n=phina.geom.Vector2.mul(e,i);return phina.geom.Vector2.sub(t,n)},lerp:function(t,e,i){return phina.geom.Vector2(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},slerp:function(t,e,i){},random:function(t,e,i){return phina.geom.Vector2().random(t,e).mul(i||1)}}}),phina.geom.Vector2.ZERO=phina.geom.Vector2(0,0),phina.geom.Vector2.LEFT=phina.geom.Vector2(-1,0),phina.geom.Vector2.RIGHT=phina.geom.Vector2(1,0),phina.geom.Vector2.UP=phina.geom.Vector2(0,-1),phina.geom.Vector2.DOWN=phina.geom.Vector2(0,1)}),phina.namespace(function(){phina.define("phina.geom.Matrix33",{init:function(){arguments.length>=9?this.set.apply(this,arguments):this.identity()},set:function(t,e,i,n,s,r,a,o,h){return this.m00=t,this.m01=e,this.m02=i,this.m10=n,this.m11=s,this.m12=r,this.m20=a,this.m21=o,this.m22=h,this},identity:function(){return this.m00=1,this.m01=0,this.m02=0,this.m10=0,this.m11=1,this.m12=0,this.m20=0,this.m21=0,this.m22=1,this},clone:function(){return phina.geom.Matrix33(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)},determinant:function(){var t=this.m00,e=this.m01,i=this.m02,n=this.m10,s=this.m11,r=this.m12,a=this.m20,o=this.m21,h=this.m22;return t*s*h+n*o*i+e*r*a-i*s*a-e*n*h-r*o*t},transpose:function(){var t=function(t,e){var i=this[t];this[t]=this[e],this[e]=i}.bind(this);return t("m01","m10"),t("m02","m20"),t("m12","m21"),this},invert:function(){var t=this.m00,e=this.m01,i=this.m02,n=this.m10,s=this.m11,r=this.m12,a=this.m20,o=this.m21,h=this.m22,u=this.determinant();return this.m00=(s*h-r*o)/u,this.m01=(n*h-r*a)/u*-1,this.m02=(n*o-s*a)/u,this.m10=(e*h-i*o)/u*-1,this.m11=(t*h-i*a)/u,this.m12=(t*o-e*a)/u*-1,this.m20=(e*r-i*s)/u,this.m21=(t*r-i*n)/u*-1,this.m22=(t*s-e*n)/u,this.transpose(),this},multiply:function(t){var e=(this.m,t.m,this.m00),i=this.m01,n=this.m02,s=this.m10,r=this.m11,a=this.m12,o=this.m20,h=this.m21,u=this.m22,c=t.m00,p=t.m01,l=t.m02,f=t.m10,d=t.m11,m=t.m12,g=t.m20,y=t.m21,v=t.m22;return this.m00=e*c+i*f+n*g,this.m01=e*p+i*d+n*y,this.m02=e*l+i*m+n*v,this.m10=s*c+r*f+a*g,this.m11=s*p+r*d+a*y,this.m12=s*l+r*m+a*v,this.m20=o*c+h*f+u*g,this.m21=o*p+h*d+u*y,this.m22=o*l+h*m+u*v,this},multiplyVector2:function(t){var e=this.m00*t.x+this.m01*t.y+this.m02,i=this.m10*t.x+this.m11*t.y+this.m12;return phina.geom.Vector2(e,i)},getRow:function(t){return 0===t?[this.m00,this.m01,this.m02]:1===t?[this.m10,this.m11,this.m12]:2===t?[this.m20,this.m21,this.m22]:null},getCol:function(t){return 0===t?[this.m00,this.m10,this.m20]:1===t?[this.m01,this.m11,this.m21]:2===t?[this.m02,this.m12,this.m22]:null},toString:function(){return"|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this)}}),phina.geom.Matrix33.IDENTITY=phina.geom.Matrix33().identity()}),phina.namespace(function(){phina.define("phina.app.Object2D",{superClass:"phina.app.Element",position:null,rotation:0,scale:null,origin:null,init:function(t){this.superInit(),t={}.$safe(t,phina.app.Object2D.defaults),this.position=phina.geom.Vector2(t.x,t.y),this.scale=phina.geom.Vector2(t.scaleX,t.scaleY),this.rotation=t.rotation,this.origin=phina.geom.Vector2(t.originX,t.originY),this._matrix=phina.geom.Matrix33().identity(),this._worldMatrix=phina.geom.Matrix33().identity(),this.interactive=!1,this._overFlags={},this._touchFlags={},this.width=t.width,this.height=t.height,this.radius=t.radius,this.boundingType=t.boundingType},hitTest:function(t,e){return"rect"===this.boundingType?this.hitTestRect(t,e):"circle"!==this.boundingType||this.hitTestCircle(t,e)},hitTestRect:function(t,e){var i=this.globalToLocal(phina.geom.Vector2(t,e)),n=-this.width*this.originX,s=+this.width*(1-this.originX),r=-this.height*this.originY,a=+this.height*(1-this.originY);return n<i.x&&i.x<s&&r<i.y&&i.y<a},hitTestCircle:function(t,e){var i=this.globalToLocal(phina.geom.Vector2(t,e));return i.x*i.x+i.y*i.y<this.radius*this.radius},hitTestElement:function(t){var e=this,i=t;return e.left<i.right&&e.right>i.left&&e.top<i.bottom&&e.bottom>i.top},globalToLocal:function(t){var e=this._worldMatrix.clone();e.invert();var i=e.multiplyVector2(t);return i},setInteractive:function(t,e){return this.interactive=t,e&&(this.boundingType=e),this},setX:function(t){return this.position.x=t,this},setY:function(t){return this.position.y=t,this},setPosition:function(t,e){return this.position.x=t,this.position.y=e,this},setRotation:function(t){return this.rotation=t,this},setScale:function(t,e){return this.scale.x=t,arguments.length<=1?this.scale.y=t:this.scale.y=e,this},setOrigin:function(t,e){return this.origin.x=t,this.origin.y=e,this},setWidth:function(t){return this.width=t,this},setHeight:function(t){return this.height=t,this},setSize:function(t,e){return this.width=t,this.height=e,this},setBoundingType:function(t){return this.boundingType=t,this},moveTo:function(t,e){return this.position.x=t,this.position.y=e,this},moveBy:function(t,e){return this.position.x+=t,this.position.y+=e,this},_calcWorldMatrix:function(){if(this.parent){if(this.rotation!=this._cachedRotation){this._cachedRotation=this.rotation;var t=this.rotation*(Math.PI/180);this._sr=Math.sin(t),this._cr=Math.cos(t)}var e=this._matrix,i=this.parent._worldMatrix||phina.geom.Matrix33.IDENTITY,n=this._worldMatrix;e.m00=this._cr*this.scale.x,e.m01=-this._sr*this.scale.y,
e.m10=this._sr*this.scale.x,e.m11=this._cr*this.scale.y,e.m02=this.position.x,e.m12=this.position.y;var s=e.m00,r=e.m01,a=e.m02,o=e.m10,h=e.m11,u=e.m12,c=i.m00,p=i.m01,l=i.m02,f=i.m10,d=i.m11,m=i.m12;return n.m00=c*s+p*o,n.m01=c*r+p*h,n.m02=c*a+p*u+l,n.m10=f*s+d*o,n.m11=f*r+d*h,n.m12=f*a+d*u+m,this}},_accessor:{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},originX:{get:function(){return this.origin.x},set:function(t){this.origin.x=t}},originY:{get:function(){return this.origin.y},set:function(t){this.origin.y=t}},scaleX:{get:function(){return this.scale.x},set:function(t){this.scale.x=t}},scaleY:{get:function(){return this.scale.y},set:function(t){this.scale.y=t}},width:{get:function(){return"rect"===this.boundingType?this._width:this._diameter},set:function(t){this._width=t}},height:{get:function(){return"rect"===this.boundingType?this._height:this._diameter},set:function(t){this._height=t}},radius:{get:function(){return"rect"===this.boundingType?(this.width+this.height)/4:this._radius},set:function(t){this._radius=t,this._diameter=2*t}},top:{get:function(){return this.y-this.height*this.originY},set:function(t){this.y=t+this.height*this.originY}},right:{get:function(){return this.x+this.width*(1-this.originX)},set:function(t){this.x=t-this.width*(1-this.originX)}},bottom:{get:function(){return this.y+this.height*(1-this.originY)},set:function(t){this.y=t-this.height*(1-this.originY)}},left:{get:function(){return this.x-this.width*this.originX},set:function(t){this.x=t+this.width*this.originX}},centerX:{get:function(){return this.x+this.width/2-this.width*this.originX},set:function(t){}},centerY:{get:function(){return this.y+this.height/2-this.height*this.originY},set:function(t){}}},_static:{defaults:{x:0,y:0,scaleX:1,scaleY:1,rotation:0,originX:.5,originY:.5,width:64,height:64,radius:32,boundingType:"rect"}}})}),phina.namespace(function(){phina.define("phina.display.CanvasElement",{superClass:"phina.display.DisplayElement",init:function(t){this.superInit(t),console.warn("[phina warn] CanvasElement は非推奨になりました. DisplayElement をお使いください.")}}),phina.define("phina.display.CanvasScene",{superClass:"phina.display.DisplayScene",init:function(t){this.superInit(t),console.warn("[phina warn] CanvasScene は非推奨になりました. DisplayScene をお使いください.")}})}),phina.namespace(function(){phina.define("phina.display.DisplayElement",{superClass:"phina.app.Object2D",visible:!0,alpha:1,blendMode:"source-over",renderChildBySelf:!1,init:function(t){t=t||{},this.superInit(t),this.visible=!0,this.alpha=1,this._worldAlpha=1},setVisible:function(t){return this.visible=t,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},_calcWorldAlpha:function(){if(!this.parent)return void(this._worldAlpha=this.alpha);var t=void 0!==this.parent._worldAlpha?this.parent._worldAlpha:1;this._worldAlpha=t*this.alpha}})}),phina.namespace(function(){phina.define("phina.app.Scene",{superClass:"phina.app.Element",init:function(){this.superInit()},exit:function(t,e){if(this.app)return arguments.length>0&&("object"==typeof arguments[0]&&(t=arguments[0].nextLabel||this.nextLabel,e=arguments[0]),this.nextLabel=t,this.nextArguments=e),this.app.popScene(),this}})}),phina.namespace(function(){phina.define("phina.display.CanvasRenderer",{init:function(t){this.canvas=t,this._context=this.canvas.context},render:function(t){this.canvas.clear(),t.backgroundColor&&this.canvas.clearColor(t.backgroundColor),this._context.save(),this.renderChildren(t),this._context.restore()},renderChildren:function(t){if(t.children.length>0)for(var e=t.children.slice(),i=0,n=e.length;i<n;++i)this.renderObject(e[i])},renderObject:function(t){if(t.visible!==!1){t._calcWorldMatrix&&t._calcWorldMatrix(),t._calcWorldAlpha&&t._calcWorldAlpha();var e=this.canvas.context;if(e.globalAlpha=t._worldAlpha,e.globalCompositeOperation=t.blendMode,t._worldMatrix){var i=t._worldMatrix;e.setTransform(i.m00,i.m10,i.m01,i.m11,i.m02,i.m12)}if(t.clip){if(e.save(),t.clip(this.canvas),e.clip(),t.draw&&t.draw(this.canvas),t.renderChildBySelf===!1&&t.children.length>0)for(var n=t.children.slice(),s=0,r=n.length;s<r;++s)this.renderObject(n[s]);e.restore()}else if(t.draw&&t.draw(this.canvas),t.renderChildBySelf===!1&&t.children.length>0)for(var n=t.children.slice(),s=0,r=n.length;s<r;++s)this.renderObject(n[s])}}})}),function(){phina.define("phina.util.Grid",{width:640,columns:12,loop:!1,offset:0,init:function(){if("object"==typeof arguments[0])var t=arguments[0],e=t.width||640,i=t.columns||12,n=t.loop||!1,s=t.offset||0;else var e=arguments[0]||640,i=arguments[1]||12,n=arguments[2]||!1,s=arguments[3]||0;this.width=e,this.columns=i,this.loop=n,this.offset=s,this.unitWidth=this.width/this.columns},span:function(t){return this.loop&&(t+=this.columns,t%=this.columns),this.unitWidth*t+this.offset},unit:function(){return this.unitWidth},center:function(t){var e=t||0;return this.width/2+this.unitWidth*e}})}(),phina.namespace(function(){phina.define("phina.display.DisplayScene",{superClass:"phina.app.Scene",init:function(t){this.superInit(),t={}.$safe(t,phina.display.DisplayScene.defaults),this.canvas=phina.graphics.Canvas(),this.canvas.setSize(t.width,t.height),this.renderer=phina.display.CanvasRenderer(this.canvas),this.backgroundColor=t.backgroundColor?t.backgroundColor:null,this.width=t.width,this.height=t.height,this.gridX=phina.util.Grid(t.width,16),this.gridY=phina.util.Grid(t.height,16),this.interactive=!0,this.setInteractive=function(t){this.interactive=t},this._overFlags={},this._touchFlags={}},hitTest:function(){return!0},_update:function(){this.update&&this.update()},_render:function(){this.renderer.render(this)},_static:{defaults:{width:640,height:960}}})}),phina.namespace(function(){phina.define("phina.display.Layer",{superClass:"phina.display.DisplayElement",renderChildBySelf:!0,init:function(t){t={}.$safe(t,{width:640,height:960}),this.superInit(t),this.width=t.width,this.height=t.height,this.gridX=phina.util.Grid(t.width,16),this.gridY=phina.util.Grid(t.height,16)},draw:function(t){if(this.domElement){var e=this.domElement;t.context.drawImage(e,0,0,e.width,e.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)}}})}),phina.namespace(function(){phina.define("phina.display.CanvasLayer",{superClass:"phina.display.Layer",init:function(t){this.superInit(t),this.canvas=phina.graphics.Canvas(),this.canvas.width=this.width,this.canvas.height=this.height,this.renderer=phina.display.CanvasRenderer(this.canvas),this.domElement=this.canvas.domElement,this.on("enterframe",function(){var t=this._worldMatrix;this._worldMatrix=null,this.renderer.render(this),this._worldMatrix=t})},draw:function(t){var e=this.domElement;t.context.drawImage(e,0,0,e.width,e.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)}})}),phina.namespace(function(){phina.define("phina.display.ThreeLayer",{superClass:"phina.display.Layer",scene:null,camera:null,light:null,renderer:null,init:function(t){this.superInit(t),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,t.width/t.height,1,1e4),this.camera.position.z=1e3,this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(1,1,1).normalize(),this.scene.add(this.light),this.renderer=new THREE.WebGLRenderer,this.renderer.setClearColor(15790320),this.renderer.setSize(t.width,t.height),this.on("enterframe",function(){this.renderer.render(this.scene,this.camera)}),this.domElement=this.renderer.domElement}})}),phina.namespace(function(){phina.define("phina.display.PlainElement",{superClass:"phina.display.DisplayElement",init:function(t){this.superInit(t),this.canvas=phina.graphics.Canvas(),this.canvas.setSize(this.width,this.height)},draw:function(t){var e=this.canvas.domElement,i=e.width,n=e.height,s=-i*this.origin.x,r=-n*this.origin.y;t.context.drawImage(e,0,0,i,n,s,r,i,n)}})}),phina.namespace(function(){var t=phina.define("phina.display.Shape",{superClass:"phina.display.PlainElement",init:function(t){t={}.$safe(t,{width:64,height:64,padding:8,backgroundColor:"#aaa",fill:"#00a",stroke:"#aaa",strokeWidth:4,shadow:!1,shadowBlur:4}),this.superInit(t),this.padding=t.padding,this.backgroundColor=t.backgroundColor,this.fill=t.fill,this.stroke=t.stroke,this.strokeWidth=t.strokeWidth,this.shadow=t.shadow,this.shadowBlur=t.shadowBlur,this.watchDraw=!0,this._dirtyDraw=!0,this.on("enterframe",function(){this.watchDraw&&this._dirtyDraw===!0&&(this.render(this.canvas),this._dirtyDraw=!1)})},calcCanvasWidth:function(){return this.width+2*this.padding},calcCanvasHeight:function(){return this.height+2*this.padding},calcCanvasSize:function(){return{width:this.calcCanvasWidth(),height:this.calcCanvasHeight()}},isStrokable:function(){return this.stroke&&0<this.strokeWidth},prerender:function(t){},postrender:function(t){},renderFill:function(t){t.fill()},renderStroke:function(t){t.stroke()},render:function(t){var e=t.context,i=this.calcCanvasSize();return t.setSize(i.width,i.height),t.clearColor(this.backgroundColor),t.transformCenter(),this.prerender(this.canvas),this.isStrokable()&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.lineJoin="round",e.shadowBlur=0,this.renderStroke(t)),this.fill&&(e.fillStyle=this.fill,this.shadow?(e.shadowColor=this.shadow,e.shadowBlur=this.shadowBlur):e.shadowBlur=0,this.renderFill(t)),this.postrender(this.canvas),this},_static:{watchRenderProperty:function(t){this.prototype.$watch(t,function(t,e){t!==e&&(this._dirtyDraw=!0)})},watchRenderProperties:function(e){var i=this.watchRenderProperty||t.watchRenderProperty;e.each(function(t){i.call(this,t)},this)}},_defined:function(){this.watchRenderProperties(["width","height","radius","padding","backgroundColor","fill","stroke","strokeWidth","shadow","shadowBlur"])}})}),phina.namespace(function(){phina.define("phina.display.RectangleShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"blue",stroke:"#aaa",strokeWidth:4,cornerRadius:0}),this.superInit(t),this.cornerRadius=t.cornerRadius},prerender:function(t){t.roundRect(-this.width/2,-this.height/2,this.width,this.height,this.cornerRadius)},_defined:function(){phina.display.Shape.watchRenderProperty.call(this,"cornerRadius")}})}),phina.namespace(function(){phina.define("phina.display.CircleShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"red",stroke:"#aaa",strokeWidth:4,radius:32}),this.superInit(t),this.setBoundingType("circle")},prerender:function(t){t.circle(0,0,this.radius)}})}),phina.namespace(function(){phina.define("phina.display.TriangleShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"green",stroke:"#aaa",strokeWidth:4,radius:32}),this.superInit(t),this.setBoundingType("circle")},prerender:function(t){t.polygon(0,0,this.radius,3)}})}),phina.namespace(function(){phina.define("phina.display.StarShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"yellow",stroke:"#aaa",strokeWidth:4,radius:32,sides:5,sideIndent:.38}),this.superInit(t),this.setBoundingType("circle"),this.sides=t.sides,this.sideIndent=t.sideIndent},prerender:function(t){t.star(0,0,this.radius,this.sides,this.sideIndent)},_defined:function(){phina.display.Shape.watchRenderProperty.call(this,"sides"),phina.display.Shape.watchRenderProperty.call(this,"sideIndent")}})}),phina.namespace(function(){phina.define("phina.display.PolygonShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"cyan",stroke:"#aaa",strokeWidth:4,radius:32,sides:5}),this.superInit(t),this.setBoundingType("circle"),this.sides=t.sides},prerender:function(t){t.polygon(0,0,this.radius,this.sides)},_defined:function(){phina.display.Shape.watchRenderProperty.call(this,"sides")}})}),phina.namespace(function(){phina.define("phina.display.HeartShape",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{backgroundColor:"transparent",fill:"pink",stroke:"#aaa",strokeWidth:4,radius:32,cornerAngle:45}),this.superInit(t),this.setBoundingType("circle"),this.cornerAngle=t.cornerAngle},prerender:function(t){t.heart(0,0,this.radius,this.cornerAngle)},_defined:function(){phina.display.Shape.watchRenderProperty.call(this,"cornerAngle")}})}),phina.namespace(function(){var t=phina.define("phina.display.PathShape",{superClass:"phina.display.Shape",paths:null,init:function(e){e={}.$safe(e||{},t.defaults),this.superInit(e),this.paths=e.paths||[],this.lineJoin=e.lineJoin,this.lineCap=e.lineCap},setPaths:function(t){return this.paths=t,this._dirtyDraw=!0,this},clear:function(){return this.paths.length=0,this._dirtyDraw=!0,this},addPaths:function(t){return[].push.apply(this.paths,t),this._dirtyDraw=!0,this},addPath:function(t,e){return this.paths.push(phina.geom.Vector2(t,e)),this._dirtyDraw=!0,this},getPath:function(t){return this.paths[t]},getPaths:function(){return this.paths},changePath:function(t,e,i){return this.paths[t].set(e,i),this._dirtyDraw=!0,this},calcCanvasSize:function(){var t=this.paths;if(0===t.length)return{width:2*this.padding,height:2*this.padding};for(var e=-(1/0),i=-(1/0),n=1/0,s=1/0,r=0,a=t.length;r<a;++r){var o=t[r];e<o.x&&(e=o.x),n>o.x&&(n=o.x),i<o.y&&(i=o.y),s>o.y&&(s=o.y)}return{width:2*Math.max(Math.abs(e),Math.abs(n))+2*this.padding,height:2*Math.max(Math.abs(i),Math.abs(s))+2*this.padding}},calcCanvasWidth:function(){return this.calcCanvasSize().width},calcCanvasHeight:function(){return this.calcCanvasSize().height},prerender:function(t){t.lineCap=this.lineCap,t.lineJoin=this.lineJoin;var e=this.paths;if(e.length>1){var i=t.context,n=e[0];i.beginPath(),i.moveTo(n.x,n.y);for(var s=1,r=e.length;s<r;++s)n=e[s],i.lineTo(n.x,n.y)}},_defined:function(){phina.display.Shape.watchRenderProperties.call(this,["lineCap","lineJoin"])},_static:{defaults:{fill:!1,backgroundColor:"transparent",lineCap:"round",lineJoin:"round"}}})}),phina.namespace(function(){phina.define("phina.display.Label",{superClass:"phina.display.Shape",init:function(t){t="object"!=typeof arguments[0]?{text:arguments[0]}:arguments[0],t={}.$safe(t,phina.display.Label.defaults),this.superInit(t),this.text=t.text,this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this.fontFamily=t.fontFamily,this.align=t.align,this.baseline=t.baseline,this.lineHeight=t.lineHeight},calcCanvasWidth:function(){var t=0,e=this.canvas;return e.context.font=this.font,this._lines.forEach(function(i){var n=e.context.measureText(i).width;t<n&&(t=n)},this),"center"!==this.align&&(t*=2),t+2*this.padding},calcCanvasHeight:function(){var t=this.fontSize*this._lines.length;return"middle"!==this.baseline&&(t*=2),t*this.lineHeight+2*this.padding},prerender:function(t){var e=t.context;e.font=this.font,e.textAlign=this.align,e.textBaseline=this.baseline;var i=this._lines;this.lineSize=this.fontSize*this.lineHeight,this._offset=-Math.floor(i.length/2)*this.lineSize,this._offset+=(i.length+1)%2*(this.lineSize/2)},renderFill:function(t){var e=t.context;this._lines.forEach(function(t,i){e.fillText(t,0,i*this.lineSize+this._offset)},this)},renderStroke:function(t){var e=t.context;this._lines.forEach(function(t,i){e.strokeText(t,0,i*this.lineSize+this._offset)},this)},_accessor:{text:{get:function(){return this._text},set:function(t){this._text=t,this._lines=(this.text+"").split("\n")}},font:{get:function(){return"{fontWeight} {fontSize}px {fontFamily}".format(this)}}},_static:{defaults:{backgroundColor:"transparent",fill:"black",stroke:null,strokeWidth:2,text:"Hello, world!",fontSize:32,fontWeight:"",fontFamily:"'HiraKakuProN-W3'",align:"center",baseline:"middle",lineHeight:1.2}},_defined:function(){var t=phina.display.Shape;t.watchRenderProperty.call(this,"text"),t.watchRenderProperty.call(this,"fontSize"),t.watchRenderProperty.call(this,"fontWeight"),t.watchRenderProperty.call(this,"fontFamily"),t.watchRenderProperty.call(this,"align"),t.watchRenderProperty.call(this,"baseline"),t.watchRenderProperty.call(this,"lineHeight")}})}),phina.namespace(function(){phina.define("phina.app.Updater",{init:function(t){this.app=t},update:function(t){this._updateElement(t)},_updateElement:function(t){var e=this.app;if(t.awake!==!1){t.has("enterframe")&&t.flare("enterframe",{app:this.app}),t.update&&t.update(e);var i=t.children.length;if(t.children.length>0)for(var n=t.children.slice(),s=0;s<i;++s)this._updateElement(n[s])}},_checkPoint:function(t){this.app.pointers.forEach(function(e){null!==e.id&&this.__checkPoint(t,e)},this)},__checkPoint:function(t,e){if(t.interactive){var i=t._overFlags[e.id],n=t.hitTest2(e.x,e.y);t._overFlags[e.id]=n,!i&&n&&t.flare("pointover",{pointer:e}),i&&!n&&t.flare("pointout"),n&&e.getPointingStart()&&(t._touchFlags[e.id]=!0,t.flare("pointstart")),t._touchFlags[e.id]&&(t.flare("pointstay"),e._moveFlag&&t.flare("pointmove")),t._touchFlags[e.id]===!0&&e.getPointingEnd()&&(t._touchFlags[e.id]=!1,t.flare("pointend"),t._overFlags[e.id]&&(t._overFlags[e.id]=!1,t.flare("pointout")))}}})}),phina.namespace(function(){phina.define("phina.app.Interactive",{init:function(t){this.app=t,this._enable=!0,this.multiTouch=!0,this.cursor={normal:"",hover:"pointer"},this._holds=[],this.app.on("changescene",function(){this._holds.clear()}.bind(this))},enable:function(){return this._enable=!0,this},disable:function(){return this._enable=!1,this},check:function(t){this.app.domElement&&(this._holds.length>0?this.app.domElement.style.cursor=this.cursor.hover:this.app.domElement.style.cursor=this.cursor.normal),this._enable&&this.app.pointers&&this._checkElement(t)},_checkElement:function(t){this.app;if(t.awake!==!1){var e=t.children.length;if(t.children.length>0)for(var i=t.children.slice(),n=0;n<e;++n)this._checkElement(i[n]);this._checkPoint(t)}},_checkPoint:function(t){this.multiTouch?this.app.pointers.forEach(function(e){null!==e.id&&this.__checkPoint(t,e)},this):this.__checkPoint(t,this.app.pointer)},__checkPoint:function(t,e){if(t.interactive){var i=t._overFlags[e.id],n=t.hitTest(e.x,e.y);t._overFlags[e.id]=n;var s={pointer:e,interactive:this,over:n};!i&&n&&(t.flare("pointover",s),t.boundingType&&"none"!==t.boundingType&&this._holds.push(t)),i&&!n&&(t.flare("pointout",s),this._holds.erase(t)),n&&e.getPointingStart()&&(t._touchFlags[e.id]=!0,t.flare("pointstart",s),t._clicked=!0),t._touchFlags[e.id]&&(t.flare("pointstay",s),e._moveFlag&&t.flare("pointmove",s)),t._touchFlags[e.id]===!0&&e.getPointingEnd()&&(t._touchFlags[e.id]=!1,t.flare("pointend",s),t._overFlags[e.id]&&(t._overFlags[e.id]=!1,t.flare("pointout",s)))}}})}),function(){phina.define("phina.util.Ticker",{superClass:"phina.util.EventDispatcher",frame:null,deltaTime:null,elapsedTime:null,init:function(){this.superInit(),this.fps=30,this.frame=0,this.deltaTime=0,this.elapsedTime=0,this.runner=phina.util.Ticker.runner},tick:function(t){this.on("tick",t)},run:function(){var t=(new Date).getTime();this.deltaTime=t-this.currentTime,this.elapsedTime=t-this.startTime;var e=this.currentTime=t;this.flare("tick");var i=(new Date).getTime();this.frame+=1;var n=i-e,s=Math.max(this.frameTime-n,0);return s},start:function(){var t=this;this.startTime=this.currentTime=(new Date).getTime();var e=t.runner,i=function(){var n=t.run();e(i,n)};return i(),this},resume:function(){},stop:function(){},rewind:function(){},_accessor:{fps:{get:function(){return this._fps},set:function(t){this._fps=t,this.frameTime=1e3/this._fps}}},_static:{runner:function(t,e){setTimeout(t,e)}}})}(),phina.namespace(function(){phina.define("phina.app.BaseApp",{superClass:"phina.util.EventDispatcher",awake:null,fps:null,frame:null,init:function(){this.superInit(),this._scenes=[phina.app.Scene()],this._sceneIndex=0,this.updater=phina.app.Updater(this),this.interactive=phina.app.Interactive(this),this.awake=!0,this.ticker=phina.util.Ticker()},run:function(){var t=this;return this.ticker.tick(function(){t._loop()}),this.ticker.start(),this},replaceScene:function(t){this.flare("replace"),this.flare("changescene");return this.currentScene&&(this.currentScene.app=null),this.currentScene=t,this.currentScene.app=this,this.currentScene.flare("enter",{app:this}),this},pushScene:function(t){return this.flare("push"),this.flare("changescene"),this.currentScene.flare("pause",{app:this}),this._scenes.push(t),++this._sceneIndex,this.flare("pushed"),t.app=this,t.flare("enter",{app:this}),this},popScene:function(){this.flare("pop"),this.flare("changescene");var t=this._scenes.pop();return--this._sceneIndex,t.flare("exit",{app:this}),t.app=null,this.flare("poped"),this.currentScene.flare("resume",{app:this,prevScene:t}),t},start:function(){return this.awake=!0,this},stop:function(){return this.awake=!1,this},enableStats:function(){if(phina.global.Stats)this.stats=new Stats,document.body.appendChild(this.stats.domElement);else{var t="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r14/Stats.js",e=document.createElement("script");e.src=t,document.body.appendChild(e),e.onload=function(){this.enableStats()}.bind(this)}return this},enableDatGUI:function(t){if(phina.global.dat){var e=new phina.global.dat.GUI;t(e)}else{var i="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.js",n=document.createElement("script");n.src=i,document.body.appendChild(n),n.onload=function(){var e=new phina.global.dat.GUI;t(e)}.bind(this)}return this},_loop:function(){this._update(),this._draw(),this.interactive.check(this.currentScene),this.stats&&this.stats.update()},_update:function(){this.awake&&(this.has("enterframe")&&this.flare("enterframe"),this.update&&this.update(),this.updater.update(this.currentScene))},_draw:function(){},_accessor:{currentScene:{get:function(){return this._scenes[this._sceneIndex]},set:function(t){this._scenes[this._sceneIndex]=t}},rootScene:{get:function(){return this._scenes[0]},set:function(t){this._scenes[0]=t}},frame:{get:function(){return this.ticker.frame},set:function(t){this.ticker.frame=t}},fps:{get:function(){return this.ticker.fps},set:function(t){this.ticker.fps=t}},deltaTime:{get:function(){return this.ticker.deltaTime}},elapsedTime:{get:function(){return this.ticker.elapsedTime}},currentTime:{get:function(){return this.ticker.currentTime}},startTime:{get:function(){return this.ticker.startTime}}}})}),function(){phina.define("phina.input.Input",{superClass:"phina.util.EventDispatcher",domElement:null,init:function(t){this.superInit(),this.domElement=t||window.document,this.position=phina.geom.Vector2(0,0),this.startPosition=phina.geom.Vector2(0,0),this.deltaPosition=phina.geom.Vector2(0,0),this.prevPosition=phina.geom.Vector2(0,0),this._tempPosition=phina.geom.Vector2(0,0),this.maxCacheNum=phina.input.Input.defaults.maxCacheNum,this.minDistance=phina.input.Input.defaults.minDistance,this.maxDistance=phina.input.Input.defaults.maxDistance,this.cachePositions=[],this.flickVelocity=phina.geom.Vector2(0,0),this.flags=0},update:function(){this.last=this.now,this.now=this.flags,this.start=(this.now^this.last)&this.now,this.end=(this.now^this.last)&this.last,this.deltaPosition.x=this._tempPosition.x-this.position.x,this.deltaPosition.y=this._tempPosition.y-this.position.y,0===this.deltaPosition.x&&0===this.deltaPosition.y?this._moveFlag=!1:this._moveFlag=!0,this.start&&this.startPosition.set(this.position.x,this.position.y),this.prevPosition.set(this.position.x,this.position.y),this.position.set(this._tempPosition.x,this._tempPosition.y),this.cachePositions.length>this.maxCacheNum&&this.cachePositions.shift(),this.cachePositions.push(this.position.clone())},_start:function(t,e,i){i=void 0!==i?i:1,this._move(t,e),this.flags|=i;var t=this._tempPosition.x,e=this._tempPosition.y;this.position.set(t,e),this.prevPosition.set(t,e),this.flickVelocity.set(0,0),this.cachePositions.clear()},_end:function(t){if(t=void 0!==t?t:1,this.flags&=~t,!(this.cachePositions.length<2)){var e=this.cachePositions.first,i=this.cachePositions.last,n=phina.geom.Vector2.sub(i,e),s=n.length();if(s>this.minDistance){var r=s.clamp(this.minDistance,this.maxDistance);n.div(s).mul(r),this.flickVelocity.set(n.x,n.y)}this.cachePositions.clear()}},_move:function(t,e){this._tempPosition.x=t,this._tempPosition.y=e;var i=this.domElement;i.style.width&&(this._tempPosition.x*=i.width/parseInt(i.style.width)),i.style.height&&(this._tempPosition.y*=i.height/parseInt(i.style.height))},_accessor:{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},dx:{get:function(){return this.deltaPosition.x},set:function(t){this.deltaPosition.x=t}},dy:{get:function(){return this.deltaPosition.y},set:function(t){this.deltaPosition.y=t}},fx:{get:function(){return this.flickVelocity.x},set:function(t){this.flickVelocity.x=t}},fy:{get:function(){return this.flickVelocity.y},set:function(t){this.flickVelocity.y=t}}},_static:{defaults:{maxCacheNum:3,minDistance:10,maxDistance:100}}})}(),function(){phina.define("phina.input.Mouse",{superClass:"phina.input.Input",init:function(t){this.superInit(t),this.id=0;var e=this;this.domElement.addEventListener("mousedown",function(t){e._start(t.pointX,t.pointY,1<<t.flags)}),this.domElement.addEventListener("mouseup",function(t){e._end(1<<t.flags)}),this.domElement.addEventListener("mousemove",function(t){e._move(t.pointX,t.pointY)})},getButton:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.now&e)},getButtonDown:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.start&e)},getButtonUp:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.end&e)},_static:{BUTTON_LEFT:1,BUTTON_MIDDLE:2,BUTTON_RIGHT:4}});var t={left:phina.input.Mouse.BUTTON_LEFT,middle:phina.input.Mouse.BUTTON_MIDDLE,right:phina.input.Mouse.BUTTON_RIGHT};phina.input.Mouse.prototype.getPointing=function(){return this.getButton("left")},phina.input.Mouse.prototype.getPointingStart=function(){return this.getButtonDown("left")},phina.input.Mouse.prototype.getPointingEnd=function(){return this.getButtonUp("left")}}(),function(){phina.define("phina.input.Touch",{superClass:"phina.input.Input",init:function(t,e){if(this.superInit(t),this.id=null,e!==!0){var i=this;this.domElement.addEventListener("touchstart",function(t){i._start(t.pointX,t.pointY,!0)}),this.domElement.addEventListener("touchend",function(t){i._end()}),this.domElement.addEventListener("touchmove",function(t){i._move(t.pointX,t.pointY)})}},getTouch:function(){return 0!=this.now},getTouchStart:function(){return 0!=this.start},getTouchEnd:function(){return 0!=this.end}}),phina.input.Touch.prototype.getPointing=phina.input.Touch.prototype.getTouch,phina.input.Touch.prototype.getPointingStart=phina.input.Touch.prototype.getTouchStart,phina.input.Touch.prototype.getPointingEnd=phina.input.Touch.prototype.getTouchEnd}(),function(){phina.define("phina.input.TouchList",{domElement:null,touchMap:null,touches:null,_id:null,init:function(t){this.domElement=t,this.touches=[];var e=this.touchMap={};this._id=new Uint32Array(1);var i=this,n=Array.prototype.forEach;this.domElement.addEventListener("touchstart",function(t){n.call(t.changedTouches,function(t){var n=i.getEmpty();e[t.identifier]=n,n._start(t.pointX,t.pointY)})}),this.domElement.addEventListener("touchend",function(t){n.call(t.changedTouches,function(t){var i=t.identifier,n=e[i];n._end(),delete e[i]})}),this.domElement.addEventListener("touchmove",function(t){n.call(t.changedTouches,function(t){var i=e[t.identifier];i._move(t.pointX,t.pointY)}),t.stop()}),this.domElement.addEventListener("touchcancel",function(t){console.warn("この端末での同時タッチ数の制限を超えました。"),n.call(t.changedTouches,function(t){var i=t.identifier,n=e[i];n._end(),delete e[i]}),t.stop()})},getEmpty:function(){var t=phina.input.Touch(this.domElement,!0);return t.id=this.id,this.touches.push(t),t},getTouch:function(t){return this.touchMap[t]},removeTouch:function(t){var e=this.touches.indexOf(t);this.touches.splice(e,1)},update:function(){this.touches.forEach(function(t){t.released?(t.released=!1,this.removeTouch(t)):(t.update(),0===t.flags&&(t.released=!0))},this)},_accessor:{id:{get:function(){return this._id[0]++}}}})}(),phina.namespace(function(){phina.define("phina.input.Keyboard",{superClass:"phina.input.Input",init:function(t){this.superInit(t),this.key={},this.press={},this.down={},this.up={},this.last={},this._keydown=null,this._keyup=null,this._keypress=null;var e=this;this.domElement.addEventListener("keydown",function(t){e.key[t.keyCode]=!0,e._keydown=t.keyCode}),this.domElement.addEventListener("keyup",function(t){e.key[t.keyCode]=!1,e._keyup=t.keyCode}),this.domElement.addEventListener("keypress",function(t){e._keypress=t.keyCode})},update:function(){for(var t in this.key)this.last[t]=this.press[t],this.press[t]=this.key[t],this.down[t]=(this.press[t]^this.last[t])&this.press[t],this.up[t]=(this.press[t]^this.last[t])&this.last[t];return this._keydown&&(this.flare("keydown",{keyCode:this._keydown}),this._keydown=null),this._keyup&&(this.flare("keyup",{keyCode:this._keyup}),this._keyup=null),this._keypress&&(this.flare("keypress",{keyCode:this._keypress}),this._keypress=null),this},getKey:function(t){return"string"==typeof t&&(t=phina.input.Keyboard.KEY_CODE[t]),!!this.press[t]==!0},getKeyDown:function(t){return"string"==typeof t&&(t=phina.input.Keyboard.KEY_CODE[t]),1==this.down[t]},getKeyUp:function(t){return"string"==typeof t&&(t=phina.input.Keyboard.KEY_CODE[t]),1==this.up[t]},getKeyAngle:function(){var t=null,e=this.getKey("left")<<3|this.getKey("up")<<2|this.getKey("right")<<1|this.getKey("down");return 0!==e&&phina.input.Keyboard.ARROW_BIT_TO_ANGLE_TABLE.hasOwnProperty(e)&&(t=phina.input.Keyboard.ARROW_BIT_TO_ANGLE_TABLE[e]),t},getKeyDirection:function(){var t=phina.geom.Vector2(0,0);return this.getKey("left")?t.x=-1:this.getKey("right")&&(t.x=1),this.getKey("up")?t.y=-1:this.getKey("down")&&(t.y=1),t.x&&t.y&&t.div(Math.SQRT2),t},setKey:function(t,e){return"string"==typeof t&&(t=phina.input.Keyboard.KEY_CODE[t]),this.key[t]=e,this},clearKey:function(){return this.key={},this},_static:{ARROW_BIT_TO_ANGLE_TABLE:{1:270,2:0,4:90,8:180,6:45,3:315,12:135,9:225,14:90,13:180,11:270,7:0},KEY_CODE:{backspace:8,tab:9,enter:13,return:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,q:81,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,"forward slash":191,"/":191,"grave accent":192,"open bracket":219,"back slash":220,"close bracket":221,"single quote":222,space:32}}})}),phina.namespace(function(){phina.define("phina.geom.Vector3",{x:0,y:0,z:0,init:function(t,e,i){this.x=t,this.y=e,this.z=i}})}),phina.namespace(function(){phina.define("phina.input.Accelerometer",{init:function(){var t=this;this.gravity=phina.geom.Vector3(0,0,0),this.acceleration=phina.geom.Vector3(0,0,0),this.rotation=phina.geom.Vector3(0,0,0),this.orientation=phina.geom.Vector3(0,0,0),phina.isMobile()&&(phina.global.addEventListener("devicemotion",function(e){var i=t.acceleration,n=t.gravity,s=t.rotation;e.acceleration&&(i.x=e.acceleration.x,i.y=e.acceleration.y,i.z=e.acceleration.z),e.accelerationIncludingGravity&&(n.x=e.accelerationIncludingGravity.x,n.y=e.accelerationIncludingGravity.y,n.z=e.accelerationIncludingGravity.z),e.rotationRate&&(s.x=s.beta=e.rotationRate.beta,s.y=s.gamma=e.rotationRate.gamma,
s.z=s.alpha=e.rotationRate.alpha)}),phina.global.addEventListener("deviceorientation",function(e){var i=t.orientation;i.alpha=e.alpha,i.beta=e.beta,i.gamma=e.gamma}))}})}),phina.namespace(function(){phina.define("phina.display.DomApp",{superClass:"phina.app.BaseApp",domElement:null,init:function(t){this.superInit(t),t.domElement?this.domElement=t.domElement:t.query?this.domElement=document.querySelector(t.query):console.assert("error"),void 0!==t.fps&&(this.fps=t.fps),"function"==typeof t.runner&&(this.ticker.runner=t.runner),this.mouse=phina.input.Mouse(this.domElement),this.touch=phina.input.Touch(this.domElement),this.touchList=phina.input.TouchList(this.domElement,5),this.keyboard=phina.input.Keyboard(document),this.accelerometer=phina.input.Accelerometer(),this.pointer=this.touch,this.pointers=this.touchList.touches,this.domElement.addEventListener("touchstart",function(){this.pointer=this.touch,this.pointers=this.touchList.touches}.bind(this)),this.domElement.addEventListener("mouseover",function(){this.pointer=this.mouse,this.pointers=[this.mouse]}.bind(this)),this.keyboard.on("keydown",function(t){this.currentScene&&this.currentScene.flare("keydown",{keyCode:t.keyCode})}.bind(this)),this.keyboard.on("keyup",function(t){this.currentScene&&this.currentScene.flare("keyup",{keyCode:t.keyCode})}.bind(this)),this.keyboard.on("keypress",function(t){this.currentScene&&this.currentScene.flare("keypress",{keyCode:t.keyCode})}.bind(this));var e=phina.isMobile()?"touchend":"mouseup";this.domElement.addEventListener(e,this._checkClick.bind(this)),this.domElement.addEventListener("touchstart",function(t){t.stop()}),this.domElement.addEventListener("touchmove",function(t){t.stop()}),phina.global.addEventListener("focus",function(){this.flare("focus"),this.currentScene.flare("focus")}.bind(this),!1),phina.global.addEventListener("blur",function(){this.flare("blur"),this.currentScene.flare("blur")}.bind(this),!1),this.on("enterframe",function(){this.mouse.update(),this.touch.update(),this.touchList.update(),this.keyboard.update()})},_checkClick:function(t){var e=function(t){t.children.length>0&&t.children.each(function(t){e(t)}),t._clicked&&t.has("click")&&t.flare("click"),t._clicked=!1};e(this.currentScene)}})}),phina.namespace(function(){phina.define("phina.display.CanvasApp",{superClass:"phina.display.DomApp",init:function(t){t=(t||{}).$safe(phina.display.CanvasApp.defaults),t.query||t.domElement||(t.domElement=document.createElement("canvas"),t.append&&document.body.appendChild(t.domElement)),!t.runner&&phina.isAndroid()&&(t.runner=phina.global.requestAnimationFrame),this.superInit(t),this.gridX=phina.util.Grid({width:t.width,columns:t.columns}),this.gridY=phina.util.Grid({width:t.height,columns:t.columns}),this.canvas=phina.graphics.Canvas(this.domElement),this.canvas.setSize(t.width,t.height),this.backgroundColor=void 0!==t.backgroundColor?t.backgroundColor:"white",this.replaceScene(phina.display.DisplayScene({width:t.width,height:t.height})),t.fit&&this.fitScreen(),t.pixelated&&(this.domElement.style.imageRendering="pixelated"),this.on("push",function(){this.currentScene.canvas&&this._draw()})},_draw:function(){this.backgroundColor?this.canvas.clearColor(this.backgroundColor):this.canvas.clear(),this.currentScene.canvas&&(this.currentScene._render(),this._scenes.each(function(t){var e=t.canvas;e&&this.canvas.context.drawImage(e.domElement,0,0,e.width,e.height)},this))},fitScreen:function(){this.canvas.fitScreen()},_static:{defaults:{width:640,height:960,columns:12,fit:!0,append:!0}}})}),phina.namespace(function(){phina.define("phina.ui.Gauge",{superClass:"phina.display.Shape",init:function(t){t={}.$safe(t,{width:256,height:32,backgroundColor:"transparent",fill:"white",stroke:"#aaa",strokeWidth:4,value:100,maxValue:100,gaugeColor:"#44f",cornerRadius:0}),this.superInit(t),this._value=t.value,this.maxValue=t.maxValue,this.gaugeColor=t.gaugeColor,this.cornerRadius=t.cornerRadius,this.visualValue=t.value,this.animation=!0,this.animationTime=1e3},isFull:function(){return this.value===this.maxValue},isEmpty:function(){return 0===this.value},setValue:function(t){if(t=Math.clamp(t,0,this._maxValue),this.value!==t)if(this.flare("change"),this._value=t,this.animation){var e=Math.abs(this.visualValue-t),i=e/this.maxValue*this.animationTime;this.tweener.ontween=function(){this._dirtyDraw=!0}.bind(this),this.tweener.clear().to({visualValue:t},i).call(function(){this.flare("changed"),this.isEmpty()?this.flare("empty"):this.isFull()&&this.flare("full")},this)}else this.visualValue=t,this.flare("changed"),this.isEmpty()?this.flare("empty"):this.isFull()&&this.flare("full")},getRate:function(){var t=this.visualValue/this.maxValue;return t},prerender:function(t){t.roundRect(-this.width/2,-this.height/2,this.width,this.height,this.cornerRadius)},postrender:function(t){var e=this.getRate();t.context.fillStyle=this.gaugeColor,t.context.save(),t.context.clip(),t.fillRect(-this.width/2,-this.height/2,this.width*e,this.height),t.context.restore()},_accessor:{value:{get:function(){return this._value},set:function(t){this.setValue(t)}}},_defined:function(){phina.display.Shape.watchRenderProperty.call(this,"value"),phina.display.Shape.watchRenderProperty.call(this,"maxValue"),phina.display.Shape.watchRenderProperty.call(this,"gaugeColor"),phina.display.Shape.watchRenderProperty.call(this,"cornerRadius")}})}),phina.namespace(function(){phina.define("phina.ui.CircleGauge",{superClass:"phina.ui.Gauge",init:function(t){t=(t||{}).$safe({backgroundColor:"transparent",fill:"#aaa",stroke:"#222",radius:64,anticlockwise:!0,showPercentage:!1}),this.superInit(t),this.setBoundingType("circle"),this.radius=t.radius,this.anticlockwise=t.anticlockwise,this.showPercentage=t.showPercentage},prerender:function(t){var e=this.getRate(),i=2*Math.PI*e;this.startAngle=0,this.endAngle=i,this.canvas.rotate(.5*-Math.PI),this.canvas.scale(1,-1)},renderFill:function(t){t.fillPie(0,0,this.radius,this.startAngle,this.endAngle)},renderStroke:function(t){t.strokeArc(0,0,this.radius,this.startAngle,this.endAngle)},postrender:function(){}})}),phina.namespace(function(){phina.define("phina.game.ManagerScene",{superClass:"phina.app.Scene",init:function(t){this.superInit(),this.setScenes(t.scenes),this.on("enter",function(){this.gotoScene(t.startLabel||0)}.bind(this)),this.on("resume",this.onnext.bind(this)),this.commonArguments={}},setScenes:function(t){return this.scenes=t,this.sceneIndex=0,this},replaceScene:function(t,e){var i="string"==typeof t?this.labelToIndex(t):t||0,n=this.scenes[i];n||console.error("phina.js error: `{0}` に対応するシーンがありません.".format(t));var s=phina.using(n.className);"function"!=typeof s&&(s=phina.using("phina.game."+n.className));var r={}.$extend(n.arguments,e),a=s.call(null,r);return a.nextLabel||(a.nextLabel=n.nextLabel),a.nextArguments||(a.nextArguments=n.nextArguments),this.app.replaceScene(a),this.sceneIndex=i,this},gotoScene:function(t,e){var i="string"==typeof t?this.labelToIndex(t):t||0,n=this.scenes[i];n||console.error("phina.js error: `{0}` に対応するシーンがありません.".format(t));var s=phina.using(n.className);"function"!=typeof s&&(s=phina.using("phina.game."+n.className));var r={}.$extend(n.arguments,e),a=s.call(null,r);return a.nextLabel||(a.nextLabel=n.nextLabel),a.nextArguments||(a.nextArguments=n.nextArguments),this.app.pushScene(a),this.sceneIndex=i,this},gotoNext:function(t){var e=this.scenes[this.sceneIndex],i=null;return e.nextLabel?i=this.labelToIndex(e.nextLabel):this.sceneIndex+1<this.scenes.length&&(i=this.sceneIndex+1),null!==i?this.gotoScene(i,t):this.flare("finish"),this},getCurrentIndex:function(){return this.sceneIndex},getCurrentLabel:function(){return this.scenes[this.sceneIndex].label},labelToIndex:function(t){var e=this.scenes.filter(function(e){return e.label==t})[0];return this.scenes.indexOf(e)},indexToLabel:function(t){return this.scenes[t].label},onnext:function(t){var e=t.prevScene.nextLabel,i=t.prevScene.nextArguments;e?this.gotoScene(e,i):this.gotoNext(i)}})}),phina.namespace(function(){phina.define("phina.game.LoadingScene",{superClass:"phina.display.DisplayScene",init:function(t){t={}.$safe(t,phina.game.LoadingScene.defaults),this.superInit(t),this.fromJSON({children:{gauge:{className:"phina.ui.Gauge",arguments:{value:0,width:this.width,height:12,fill:"#aaa",stroke:!1,gaugeColor:"hsla(200, 100%, 80%, 0.8)",padding:0},x:this.gridX.center(),y:0,originY:0}}});var e=phina.asset.AssetLoader();t.lie?(this.gauge.animationTime=1e4,this.gauge.value=90,e.onload=function(){this.gauge.animationTime=0,this.gauge.value=100}.bind(this)):(this.gauge.animationTime=100,e.onprogress=function(t){this.gauge.value=100*t.progress}.bind(this)),this.gauge.onfull=function(){"auto"===t.exitType&&this.app.popScene(),this.flare("loaded")}.bind(this),e.load(t.assets)},_static:{defaults:{exitType:"auto",lie:!1}}})}),phina.namespace(function(){phina.define("phina.display.Sprite",{superClass:"phina.display.DisplayElement",init:function(t,e,i){this.superInit(),this.srcRect=phina.geom.Rect(),this.setImage(t,e,i)},draw:function(t){var e=this.image.domElement,i=this.srcRect;t.context.drawImage(e,i.x,i.y,i.width,i.height,-this._width*this.originX,-this._height*this.originY,this._width,this._height)},setImage:function(t,e,i){return"string"==typeof t&&(t=phina.asset.AssetManager.get("image",t)),this._image=t,this.width=this._image.domElement.width,this.height=this._image.domElement.height,e&&(this.width=e),i&&(this.height=i),this.frameIndex=0,this},setFrameIndex:function(t,e,i){var n=e||this._width,s=i||this._height,r=~~(this.image.domElement.width/n),a=~~(this.image.domElement.height/s),o=r*a;t%=o;var h=t%r,u=~~(t/r);return this.srcRect.x=h*n,this.srcRect.y=u*s,this.srcRect.width=n,this.srcRect.height=s,this._frameIndex=t,this},_accessor:{image:{get:function(){return this._image},set:function(t){return this.setImage(t),this}},frameIndex:{get:function(){return this._frameIndex},set:function(t){return this.setFrameIndex(t),this}}}})}),phina.namespace(function(){phina.define("phina.game.SplashScene",{superClass:"phina.display.DisplayScene",init:function(t){var e=phina.game.SplashScene.defaults;this.superInit(t);var i=phina.asset.Texture();i.load(e.imageURL).then(function(){this._init()}.bind(this)),this.texture=i},_init:function(){this.sprite=phina.display.Sprite(this.texture).addChildTo(this),this.sprite.setPosition(this.gridX.center(),this.gridY.center()),this.sprite.alpha=0,this.sprite.tweener.clear().to({alpha:1},500,"easeOutCubic").wait(1e3).to({alpha:0},500,"easeOutCubic").wait(250).call(function(){this.exit()},this)},_static:{defaults:{imageURL:"http://cdn.rawgit.com/phi-jp/phina.js/develop/logo.png"}}})});